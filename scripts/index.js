import{ItemStack as vr,MinecraftItemTypes as Er}from"@minecraft/server";import{world as uo}from"@minecraft/server";var S="-";import{world as lo}from"@minecraft/server";import{ItemStack as so,MinecraftItemTypes as ao,system as co}from"@minecraft/server";import{BlockLocation as ro}from"@minecraft/server";var Rt=32e3,ie="rubedo:database",N=new ro(0,-64,0),Dt=128;import{BlockLocation as Ke,MinecraftDimensionTypes as J,system as Z,world as Q}from"@minecraft/server";import{MessageFormData as io}from"@minecraft/server-ui";var X=class{constructor(e,n){this.title=e,this.body=n,this.form=new io,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};var h={overworld:Q.getDimension(J.overworld),nether:Q.getDimension(J.nether),theEnd:Q.getDimension(J.theEnd),"minecraft:overworld":Q.getDimension(J.overworld),"minecraft:nether":Q.getDimension(J.nether),"minecraft:the_end":Q.getDimension(J.theEnd)};function ae(t){let e=t.split(",");console.warn(e.length);let n=0;for(let o of e){let r=parseInt(o.match(/\D+|\d+/g)[0]),i=o.match(/\D+|\d+/g)[1];i=="y"&&(n=n+317098e-16*r),i=="w"&&(n=n+6048e5*r),i=="d"&&(n=n+864e5*r),i=="h"&&(n=n+36e5*r),i=="m"&&(n=n+6e4*r),i=="s"&&(n=n+1e3*r),i=="ms"&&(n=n+r)}return n}function ee(t){return new Date(t).toString()}function Lt(t){return new Ke(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}function G(t,e,n,o=()=>{}){new X("Confirm To Continue",e).setButton1("Confirm",n).setButton2("Never Mind",o).show(t)}function _t(t){return new Promise(e=>{let n=Z.runSchedule(()=>{e(),Z.clearRunSchedule(n)},t)})}function Mt(t,e){let n=[t.x,t.y,t.z],o=[t.x,t.y,t.z];return(t instanceof Ke||e instanceof Ke)&&(n=n.map(r=>Math.trunc(r)),o=o.map(r=>Math.trunc(r))),!n.find((r,i)=>o[i]!=r)}async function ce(){if(!Te)return new Promise(t=>{let e=Z.runSchedule(async()=>{try{await h.overworld.runCommandAsync("testfor @a"),Z.clearRunSchedule(e),Ue(),t()}catch{}},1)})}function Ot(t){if(Te)return t();let e=Z.runSchedule(async()=>{try{await h.overworld.runCommandAsync("testfor @a"),Z.clearRunSchedule(e),Ue(),t()}catch{}},1)}function $t(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}var b=class{constructor(e){this.tableName=e;this.tableName=e,this.MEMORY=null,this.QUEUE=[],co.runSchedule(()=>{this.QUEUE.length!=0&&this.QUEUE.shift()()},1),Ot(async()=>{this.MEMORY=await this.getData()})}static createTableEntity(e,n){let o=h.overworld.spawnEntity(ie,N);return o.setDynamicProperty("tableName",e),o.nameTag=`\xA7aDatabase Table: ${e}\xA7r`,n&&o.setDynamicProperty("index",n),o}static getTableEntities(e){return h.overworld.getEntitiesAtBlockLocation(N).filter(n=>n.typeId==ie&&n.getDynamicProperty("tableName")==e)}async addQueueTask(){return new Promise(e=>{this.QUEUE.push(()=>{e()})})}async saveData(e){await this.addQueueTask(),await ce(),this.MEMORY=e;let n=b.getTableEntities(this.tableName),o=$t(JSON.stringify(e),Rt),r=Math.ceil(o.length/Dt)-n.length;if(r>0)for(let i=0;i<r;i++)n.push(b.createTableEntity(this.tableName));for(let[i,a]of n.entries()){let c=a.getComponent("inventory").container;for(let[l,f]of o.entries()){if(!f)continue;if(l>c.size-1)break;let g=new so(ao.acaciaBoat);g.nameTag=f,c.setItem(l,g),o[l]=null}for(let l=o.length+1;l<c.size;l++)c.setItem(l,w);if(a.setDynamicProperty("index",i),n[i]=null,!o.find(l=>l))break}n.filter(i=>i).forEach(i=>i.triggerEvent("despawn"))}async getData(){if(await ce(),this.MEMORY)return this.MEMORY;let e=b.getTableEntities(this.tableName).sort((o,r)=>o.getDynamicProperty("index")-r.getDynamicProperty("index")),n="";for(let o of e){let r=o.getComponent("inventory").container;for(let i=0;i<r.size;i++){let a=r.getItem(i);!a||(n=n+a.nameTag)}}return n==""?{}:JSON.parse(n)}async set(e,n){let o=await this.getData();o[e]=n,await this.saveData(o)}get(e){if(!this.MEMORY)throw new Error("World is not loaded! Consider using `getAsync` instead!");return this.MEMORY[e]}async getSync(e){return(await this.getData())[e]}keys(){if(!this.MEMORY)throw new Error("World is not loaded! Consider using `keysSync` instead!");return Object.keys(this.MEMORY)}async keysSync(){let e=await this.getData();return Object.keys(e)}values(){if(!this.MEMORY)throw new Error("World is not loaded! Consider using `valuesSync` instead!");return Object.values(this.MEMORY)}async valuesSync(){let e=await this.getData();return Object.values(e)}has(e){if(!this.MEMORY)throw new Error("World is not loaded! Consider using `hasSync` instead!");return this.keys().includes(e)}async hasSync(e){return(await this.keysSync()).includes(e)}collection(){if(!this.MEMORY)throw new Error("World is not loaded! Consider using `collectionSync` instead!");return this.MEMORY}async collectionSync(){return await this.getData()}async delete(e){let n=await this.getData(),o=delete n[e];return await this.saveData(n),o}async clear(){await this.saveData({})}};var s={config:new b("config"),freezes:new b("freezes"),mutes:new b("mutes"),bans:new b("bans"),regions:new b("regions"),roles:new b("roles"),tasks:new b("tasks"),npcs:new b("npcs"),ids:new b("ids"),logs:new b("logs"),protections:new b("protections"),test:new b("test")};function Ft(t){return[...lo.getPlayers()].find(e=>e.name===t)}var O=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},le=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},me=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},Ye=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be valid float!"}},H=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},ue=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},We=class{constructor(e="player"){this.name=e;this.typeName="Player";this.name=e}matches(e){return{success:!!Ft(e),value:Ft(e)}}fail(e){return`player: "${e}", is not in this world`}},qe=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a valid target`}},de=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Xe=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},Je=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!s.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},p={string:le,int:me,float:Ye,location:H,boolean:ue,player:We,target:qe,array:de,duration:Xe,playerName:Je};var Pe=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function zt(t,e){try{return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}catch{return[]}}function Vt(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function Qe(t,e){t.tell({rawtext:[{text:e.data.invalidPermission?e.data.invalidPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function jt(t,e,n,o,r){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${S}${e.data.name} ${o.slice(0,r).join(" ")}`,o[r]??" ",o.slice(r+1).join(" ")]}]}),n.children.length>1||!o[r]){let i=n.children.map(a=>a.type instanceof O?a.type.name:a.type?.typeName);t.tell(`\xA7c"${o[r]??"undefined"}" is not valid! Argument "${[...new Set(n.children.map(a=>a.type.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.tell(`\xA7c${n.children[0]?.type?.fail(o[r])}`)}function mo([t,e,n],{location:o,viewVector:r}){if(!t||!e||!t)return null;let i=[o.x,o.y,o.z],a=[r.x,r.y,r.z],c=[t,e,n].map(f=>{let g=parseFloat(f);return isNaN(g)?0:g}),l=[t,e,n].map((f,g)=>f.includes("~")?c[g]+i[g]:f.includes("^")?c[g]+a[g]:c[g]);return{x:l[0],y:l[1],z:l[2]}}function Gt(t,e,n,o){let r=e[e.length-1]??o,i=[];for(let[a,c]of e.entries())if(!c.type.name.endsWith("*")){if(c.type instanceof H){i.push(mo([t[a],t[a+1],t[a+2]],n.sender));continue}c.type instanceof O||i.push(c.type.matches(t[a]).value??t[a])}r.callback(new Pe(n),...i)}var K=[];uo.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(S))return;t.cancel=!0;let e=zt(t.message,S),n=K.find(c=>c.depth==0&&(c.data.name==e[0]||c.data?.aliases?.includes(e[0]))),o={message:t.message,sendToTargets:t.sendToTargets,sender:t.sender,targets:t.targets};if(!n)return Vt(t.sender,e[0]);if(!n.data?.requires(t.sender))return Qe(o.sender,n);e.shift();let r=[],i=(c,l)=>{if(c.children.length>0){let f=c.children.find(g=>g.type.matches(e[l]).success);return!f&&!e[l]&&c.callback?void 0:f?f.data?.requires(o.sender)?(r.push(f),i(f,l+1)):(Qe(o.sender,f),"fail"):(jt(o.sender,n,c,e,l),"fail")}};i(n,0)!="fail"&&Gt(e,r,o,n)});import{Player as vo,system as gn,world as yn}from"@minecraft/server";var Ht="rubedo:gui",fe="rubedo:inventory";import{world as D,Player as nn,BlockLocation as en,MinecraftBlockTypes as po,GameMode as go,system as nt}from"@minecraft/server";import{BlockLocation as Wt,MinecraftBlockTypes as fo}from"@minecraft/server";var Kt={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntities:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},Ut=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],Yt=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box","minecraft:lit_smoker","minecraft:smoker"];var U=[],Ae=!1,Ze=-64,et=320;function tt(t,e,n){return n.every((o,r)=>o>=Math.min(t[r],e[r])&&o<=Math.max(t[r],e[r]))}var y=class{static async getAllRegionsSync(){if(Ae)return U;let e=(await s.regions.valuesSync()).map(n=>new y(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{U.push(n)}),Ae=!0,e}static getAllRegions(){if(Ae)return U;let e=s.regions.values().map(n=>new y(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{U.push(n)}),Ae=!0,e}static blockLocationInRegion(e,n){return this.getAllRegions().find(o=>o.dimensionId==n&&tt([o.from.x,Ze,o.from.z],[o.to.x,et,o.to.z],[e.x,e.y,e.z]))}static async blockLocationInRegionSync(e,n){return(await this.getAllRegionsSync()).find(o=>o.dimensionId==n&&tt([o.from.x,Ze,o.from.z],[o.to.x,et,o.to.z],[e.x,e.y,e.z]))}static async removeRegionAtBlockLocation(e,n){let o=this.blockLocationInRegion(e,n);return o?await s.regions.delete(o.key):!1}constructor(e,n,o,r,i){this.from=e,this.to=n,this.dimensionId=o,this.permissions=r??Kt,this.key=i||Date.now().toString(),i||this.update().then(()=>{xe(),U.push(this)})}async update(){return await s.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}async delete(){let e=s.regions.get(this.key),n=new Wt(e.from.x,e.dimensionId=="minecraft:overworld"?-64:0,e.from.z),o=new Wt(e.to.x,e.dimensionId=="minecraft:overworld"?-64:0,e.to.z);for(let r of n.blocksBetween(o))h[e.dimensionId].getBlock(r)?.setType(fo.bedrock);return U=U.filter(r=>r.key!=this.key),s.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&tt([this.from.x,Ze,this.from.z],[this.to.x,et,this.to.z],[e.location.x,e.location.y,e.location.z])}changePermission(e,n){this.permissions[e]=n,this.update()}};var R=class{static getTasks(){return s.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return R.getTasks().find(o=>o.playerName==e)?.role}constructor(e,n){let o=R.getTasks();o.push({playerName:e,role:n}),s.tasks.set("changePlayerRole",o)}};import{MinecraftBlockTypes as pe,MinecraftItemTypes as d}from"@minecraft/server";var qt=[d.beehive.id,d.beeNest.id,d.axolotlBucket.id,d.codBucket.id,d.tadpoleBucket.id,d.tropicalFishBucket.id,d.salmonBucket.id,d.pufferfishBucket.id],Xt=[d.allow.id,d.barrier.id,d.borderBlock.id,d.debugStick?.id??"minecraft:debug_stick",d.deny.id,d.jigsaw.id,d.lightBlock.id,d.commandBlock.id,d.repeatingCommandBlock.id,d.chainCommandBlock.id,d.commandBlockMinecart.id,d.structureBlock.id,d.structureVoid.id,d.bedrock.id,d.endPortalFrame.id,"minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingobsidian","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],Jt=[pe.dispenser.id],Qt=[pe.bedrock.id,pe.barrier.id,"minecraft:invisiblebedrock","minecraft:movingBlock","minecraft:movingblock","minecraft:moving_block"],Ne=[pe.chest.id,pe.trappedChest.id],vi=[d.chest.id,d.trappedChest.id,d.barrel.id,d.dispenser.id,d.dropper.id,d.furnace.id,"minecraft:lit_furnace",d.blastFurnace.id,"minecraft:lit_blast_furnace",d.smoker.id,"minecraft:lit_smoker",d.hopper.id,d.shulkerBox.id,d.undyedShulkerBox.id],Y={x:7,y:7,z:7};var Be={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};var Zt="2.6.3-beta";var Re="https://discord.gg/dMa3A5UYKX";function $(t,e=[],n){if(ge(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.tell("You have been tried to kick, but you cant!"),n?.();try{t.runCommandAsync(`kick @s \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(o){if(t.triggerEvent("kick"),!/"statusCode":-2147352576/.test(o))return;n&&n()}}function m(t){return t instanceof nn?s.roles.get(t.name)??"member":s.roles.get(t)??"member"}async function ot(t){return t instanceof nn?await s.roles.getSync(t.name)??"member":await s.roles.getSync(t)??"member"}function te(t,e){if(typeof t=="string"){s.roles.set(t,e);let n=[...D.getPlayers()].find(o=>o.name==t);n?n.setDynamicProperty("role",e):new R(t,e)}else s.roles.set(t.name,e),t.setDynamicProperty("role",e)}function ge(t){return D.getDynamicProperty("worldsOwner")==t.id}function rt(){let t=D.getDynamicProperty("worldsOwner");return!t||t==""?null:t}function on(){let t=rt();if(!t)return null;let e=s.ids.collection();return Object.keys(e).find(n=>e[n]===t)}function ye(t){if(!t)return D.setDynamicProperty("worldsOwner","");D.setDynamicProperty("worldsOwner",t.id.toString())}function De(){return D.getDynamicProperty("isLockDown")??!1}function it(t){D.setDynamicProperty("isLockDown",t)}function xe(){for(let t of y.getAllRegions()){let e=new en(t.from.x,t.dimensionId=="minecraft:overworld"?-64:0,t.from.z),n=new en(t.to.x,t.dimensionId=="minecraft:overworld"?-64:0,t.to.z);for(let o of e.blocksBetween(n))h[t.dimensionId].getBlock(o)?.setType(po.deny)}}var st=[],tn=0;function F(t,e=0){let n=tn;return st[n]={callback:t,delay:e,lastCall:0},tn=n+1,n}function rn(t){delete st[t]}nt.runSchedule(async()=>{let t=[...D.getPlayers()];for(let[e,n]of t.entries())if(!["moderator","admin"].includes(await ot(n)))for(let o of Object.values(st))o.delay!=0&&nt.currentTick-o.lastCall<o.delay||(o.callback(n),e==t.length-1&&(o.lastCall=nt.currentTick))});function C(t){switch(t){case"spam_config":return s.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1};case"cbe_config":return s.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1,canAddEnchantment:!1};case"gamemode_config":return s.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};case"nuker_data":return s.config.get("nuker_data")??{violationCount:0,banPlayer:!1};case"banned_items":return s.config.get("banned_items")??Xt;case"banned_blocks":return s.config.get("banned_blocks")??Qt;case"enchantments":return s.config.get("enchantments")??Be;case"appealLink":return s.config.get("appealLink")??Re}}function W(t,e){s.config.set(t,e)}function sn(t){return C("enchantments")[t.type.id]??t.type.maxLevel}function an(t){return Object.values(go).find(e=>[...D.getPlayers({name:t.name,gameMode:e})].length)}import{world as dn}from"@minecraft/server";import{system as yo}from"@minecraft/server";var at={},cn={},z={};function ho(t,e,n){if(e.length!=n.length)return[];let o=[];for(let r=0;r<n.length;r++){if(e[r]?.item?.amount<n[r]?.item?.amount||e[r]?.item?.amount>n[r]?.item?.amount&&e[r]?.item?.amount!=0){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"fluctuation"};o.push(i),z[t.id]=i;continue}if(n[r].uid!=e[r].uid)if(e[r]?.item&&n[r]?.item){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"swap"};o.push(i),z[t.id]=i}else if(n[r]?.item){if(n[r]?.item)if(z[t.id]?.changeType=="delete"&&z[t.id]?.uid==n[r].uid){let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"move"};o.push(i),z[t.id]=i;continue}else{let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"put"};o.push(i),z[t.id]=i}}else{let i={slot:r,uid:e[r].uid,item:e[r].item,changeType:"delete"};o.push(i),z[t.id]=i}}return o}function bo(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function ko(t){let e=[];for(let n=0;n<t.size;n++){let o=t.getItem(n);e[n]={uid:bo(o),item:o}}return e}yo.runSchedule(()=>{for(let t of Object.values(at))for(let e of h.overworld.getEntities(t.entities)){let n=ko(e.getComponent("inventory").container),o=ho(e,cn[e.id]??n,n);if(cn[e.id]=n,o.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete z[e.id];continue}for(let r of o)t.callback(e,r)}}},5);var he=class{static subscribe(e,n){let o=Date.now();return at[o]={callback:n,entities:e},o}static unsubscribe(e){delete at[e]}};import{Location as wo}from"@minecraft/server";import{world as Io}from"@minecraft/server";var k=class{constructor(){this.data=new Map,this.events={playerLeave:Io.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}includes(e){return this.playerNames().includes(e.name)}};var A={},ne={},be=new k;function ln(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function mn(t,e){try{let n=t.getComponent("minecraft:inventory").container,o=[];for(let r=0;r<n.size;r++){let i=n.getItem(r);!i||i?.typeId==e?.typeId&&(o.push({slot:r,item:i}),n.setItem,r<9?await t.runCommandAsync(`replaceitem entity @s slot.hotbar ${r} air`):await t.runCommandAsync(`replaceitem entity @s slot.inventory ${r-9} air`))}await t.runCommandAsync(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let r of o)n.setItem(r.slot,r.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:new wo(t.location.x,t.location.y,t.location.z),maxDistance:2,closest:1})].forEach(o=>o.kill())}}function un(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var Le=class{constructor(e,n,o){this.gui=e,this.slot=n,this.change=o}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await _t(5),await e.show(this.gui.player)}};var oe=class{static spawnEntity(e){try{return e.dimension.spawnEntity(fe,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=oe.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.tickEvent=dn.events.tick.subscribe(()=>{if(!this.entity)return this.despawn();if(be.get(this.player))this.hasChestOpen||(this.slotChangeEvent=he.subscribe({type:fe},(n,o)=>{n.id==this.entity.id&&this.onSlotChange(o)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,this.player.rotation.x,this.player.rotation.y,!0)}catch{this.despawn()}})}setPage(e,n){let o=this.entity.getComponent("inventory").container;for(let i=0;i<o.size;i++)o.setItem(i,w);if(!Object.keys(ne).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=ne[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,w);else if(e.changeType=="delete"){if(n.item&&mn(this.player,e.item),!n.item&&!un(this.entity,e.slot))return;n.action(new Le(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete A[this.player.name]}catch{}this.tickEvent&&dn.events.tick.unsubscribe(this.tickEvent),this.slotChangeEvent&&he.unsubscribe(this.slotChangeEvent)}};import{ItemStack as Co}from"@minecraft/server";var v=class{constructor(e,n={},o){this.itemType=e,this.components=n,this.setItemStack=o}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new Co(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let o of this.components?.enchantments??[])n.addEnchantment(o);e.getComponent("enchantments").enchantments=n}return e}};function fn(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,w);continue}o.setItem(r,i.item.itemStack)}}var V=class{constructor(e,n=fn){if(Object.keys(ne).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],ne[e]=this}setSlots(e,n,o){let r=n?{item:n,action:o}:null;for(let i of e)this.slots[i]=r;return this}};import{MinecraftItemTypes as pn}from"@minecraft/server";var Ss=new V("home").setSlots([22],new v(pn.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new v(pn.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});gn.runSchedule(()=>{for(let t of yn.getPlayers()){if(ln(t)?.typeId!=Ht){A[t.name]&&A[t.name].despawn();continue}Object.keys(A).includes(t?.name)||m(t)=="admin"&&(A[t.name]=new oe(t))}},5);yn.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{t.entity instanceof vo&&(t.id=="rubedo:has_container_open"?be.set(t.entity,!0):t.id=="rubedo:dosent_have_container_open"&&be.set(t.entity,!1))});gn.runSchedule(()=>{let t=Object.values(A).map(e=>e.entity.id);for(let e of h.overworld.getEntities({type:fe}))t.includes(e.id)||e.triggerEvent("despawn")},100);var _e={};var T={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occurred.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invalidType":(t,e)=>`Type ${t} is not a valid type to add a ${e}`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"\xA7cYou've been temporarily muted in chat.","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry ${n}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry: ${n}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};var u=class{constructor(e,n,o=0,r){this.data=e;this.type=n;this.depth=o;this.parent=r;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new O(this.data.name),this.children=[],this.depth=o,this.parent=r,this.callback=null,K.push(this)}argument(e){let n=new u(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new le(e))}int(e){return this.argument(new me(e))}array(e,n){return this.argument(new de(e,n))}boolean(e){return this.argument(new ue(e))}location(e){let n=this.argument(new H(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new u(e,new O(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};import{Player as bn}from"@minecraft/server";function hn(t,e,n,o="No Reason",r="Rubedo Auto Mod"){let i={key:e,playerName:t instanceof bn?t.name:t,date:Date.now(),duration:n?ae(n):null,expire:n?ae(n)+Date.now():null,reason:o,by:r};s.bans.set(e,i)}var P=class{constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){e instanceof bn?hn(e,e.id,n,o,r):hn(e,s.ids.get(e),n,o,r)}};function ct(t,e,n,o,r){if(s.bans.get(s.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);t.reply("\xA7aClose chat to confirm"),G(t.sender,`Are you sure you want to ban ${e}, for ${n??"forever"}`,()=>{new P(e,n,o,t.sender.name),t.reply(T["modules.commands.ban.reply"](e,n,o))})}var lt=new u({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(m(t))});lt.literal({name:"add",description:"Bans a player"}).argument(new p.playerName).executes((t,e)=>{ct(t,e,null,null,t.sender.name)}).argument(new p.duration("duration")).executes((t,e,n)=>{ct(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,o)=>{ct(t,e,n,o,t.sender.name)});lt.literal({name:"remove",description:"un-bans a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=s.bans.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not banned`);s.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to un-ban ${e}`)});lt.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=s.bans.values();if(e.length==0)return t.sender.tell("\xA7cNo one is banned!");t.sender.tell(`\xA72--- Showing Bans (${e.length}) ---`);for(let n of e)t.sender.tell(T["commands.ban.list.player"](n.playerName,n.reason,n.expire?ee(n.duration):"Forever"))});var ke=new u({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>m(t)=="admin"});ke.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let o=s[e].get(n);o?t.reply(JSON.stringify(o)):t.reply(`No data could be found for key ${n}`)}catch(o){t.reply(o+o.stack)}});ke.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,o)=>{try{s[e].set(n,o),t.reply(`Set Key: "${n}", to value: "${o}" on table: "${e}"`)}catch(r){t.reply(r+r.stack)}});ke.literal({name:"clear"}).string("table").executes((t,e)=>{try{s[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});ke.literal({name:"keys",description:"Returns all keys on a database"}).string("table").executes((t,e)=>{try{let n=s[e].keys();t.reply(`Keys on database: ${e}: ${n}`)}catch(n){t.reply(n+n.stack)}});ke.literal({name:"values",description:"Returns all values on a database"}).string("table").executes((t,e)=>{try{let n=s[e].values();t.reply(`Values on database: ${e}: ${JSON.stringify(n,null,2)}`)}catch(n){n instanceof TypeError?t.reply(`No values on database ${e}`):t.reply(n+n.stack)}});new u({name:"ecwipe",description:"Clears a players ender chest",requires:t=>m(t)=="admin"}).argument(new p.player("player")).executes((t,e)=>{for(let n=0;n<27;n++)e.runCommandAsync(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`\xA7aCleared "${e.name}"'s Ender chest!`)});var Me=class{constructor(e,n="No Reason"){let o={playerName:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};s.freezes.set(e.id,o)}};var mt=new u({name:"freeze",description:"Manage Freezes",requires:t=>["admin","moderator"].includes(m(t))});mt.literal({name:"add",description:"Freezes a player"}).argument(new p.player("player")).string("reason").executes((t,e,n)=>{new Me(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});mt.literal({name:"remove",description:"unfreezes a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=s.freezes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not frozen`);s.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});mt.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=s.freezes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is frozen!");t.sender.tell(`\xA72--- Showing Freezes (${e.length}) ---`);for(let n of e)t.sender.tell(T["commands.freeze.list.player"](n.playerName,n.reason))});var ut=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(K.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a valid command`}};function Eo(t,e,n){n.tell(`${S}${t.data.name} ${e.map(o=>o.type.typeName=="literal"?o.data.name:`<${o.type.name}: ${o.type.typeName}>`).join(" ")}`)}function Oe(t,e,n,o){if(!!e.data?.requires(o)&&(e.callback&&Eo(t,e.depth==0?n:n.concat(e),o),e.children.length>0))for(let r of e.children)Oe(t,r,e.depth==0?n:n.concat(e),o)}function kn(t,e,n){t.tell(`\xA72--- Showing help page ${e} of ${n} (${S}help <page: int>) ---`)}function dt(t){return K.filter(e=>e.depth==0&&e.data?.requires(t))}function In(t){let e=dt(t);return e.length==0?0:Math.ceil(e.length/5)}var wn=new u({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=In(t.sender),n=dt(t.sender).slice(1*5-5,1*5);kn(t.sender,1,e);for(let o of n)Oe(o,o,[],t.sender)});wn.int("page").executes((t,e)=>{let n=In(t.sender);e>n&&(e=n);let o=dt(t.sender).slice(e*5-5,e*5);kn(t.sender,e,n);for(let r of o)Oe(r,r,[],t.sender)});wn.argument(new ut("command")).executes((t,e)=>{let n=K.filter(o=>o.depth==0&&o.data.name==e)[0];t.sender.tell(`\xA7e${n.data.name}: ${n.data.aliases?`aliases (${n.data.aliases.join(", ")})`:""}`),t.sender.tell(`\xA7e${n.data.description}`),t.sender.tell("Usage:"),Oe(n,n,[],t.sender)});import{world as Cn}from"@minecraft/server";new u({name:"lockdown",description:"Toggles the servers lockdown, meaning no one can join",requires:t=>m(t)=="admin"}).executes(t=>{De()?(it(!1),t.sender.tell("\xA7aUnlocked the server!")):(t.reply("\xA7aClose chat to confirm lockdown"),G(t.sender,T["commands.lockdown.confirm"],()=>{it(!0);for(let e of Cn.getPlayers())m(e)!="admin"&&$(e,T["lockdown.kick.message"]());Cn.say("\xA7l\xA7cServer is now LOCKED!")}))});var B=class{static getMuteData(e){return s.mutes.get(e.name)}constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=n?ae(n):null,a={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:o,by:r};s.mutes.set(e.name,a)}};var ft=new u({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(m(t))});ft.literal({name:"add",description:"Mutes a player"}).argument(new p.player("player")).argument(new p.duration("duration")).string("reason").executes((t,e,n,o)=>{new B(e,n,o,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${o}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${o}"`)});ft.literal({name:"remove",description:"un-mutes a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=s.mutes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not muted!`);s.mutes.delete(n.playerName);try{t.sender.runCommandAsync(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});ft.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=s.mutes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is muted!");t.sender.tell(`\xA72--- Showing Mutes (${e.length}) ---`);for(let n of e)t.sender.tell(T["commands.mutes.list.player"](n.playerName,n.reason,n.expire?ee(n.expire):"Forever"))});import{Location as So}from"@minecraft/server";var re=class{static isValid(e){return e.typeId!="minecraft:npc"?!1:$e.find(n=>Mt(n,e.location))?!0:!!s.npcs.keys().find(n=>e.id==n)}constructor(e,n){$e.push(e);let o=n.spawnEntity("minecraft:npc",e),r={dimension:o.dimension.id,x:o.location.x,y:o.location.y,z:o.location.z};s.npcs.set(o.id,r),vn()}};new u({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>m(t)=="admin"}).executes(t=>{let{x:e,y:n,z:o}=t.sender.location;new re(new So(e,n,o),t.sender.dimension),t.reply("Spawned a verified npc at your current location")});import{world as En}from"@minecraft/server";new u({name:"ping",description:"Returns the current Ticks Per Second of the servers ping"}).executes(t=>{let e=En.events.tick.subscribe(({deltaTime:n})=>{t.reply(`Pong! Current Ticks Per Second: ${1/n}`),En.events.tick.unsubscribe(e)})});import{BlockLocation as Ie}from"@minecraft/server";var we=new u({name:"region",description:"Create a Region",requires:t=>m(t)=="admin"});we.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,o,r)=>{new y({x:e,z:n},{x:o,z:r},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${o} 320 ${r}`)});we.literal({name:"remove",description:"Removes a region at the players current position"}).executes(t=>{let e=new Ie(t.sender.location.x,t.sender.location.y,t.sender.location.z);y.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});we.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{y.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});we.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=y.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var pt=we.literal({name:"permission",description:"Handles permissions for regions"});pt.literal({name:"set",description:"Sets a certain permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let o=y.blockLocationInRegion(new Ie(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!o)return t.reply("You are not in a region");o.changePermission(e,n),t.reply(`Changed permission ${e} to ${n}`)});pt.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=y.blockLocationInRegion(new Ie(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var Sn=pt.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntities"});Sn.literal({name:"add",description:"Adds a entity to the allowed entities list"}).string("entity").executes((t,e)=>{let n=y.blockLocationInRegion(new Ie(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;o.push(e),n.changePermission("allowedEntities",o),t.reply(`Added entity ${e} to the allowed entities of the region your currently standing in`)});Sn.literal({name:"remove",description:"Removes a entity from the allowed entities in the region"}).string("entity").executes((t,e)=>{let n=y.blockLocationInRegion(new Ie(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;if(!o.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);o=o.filter(r=>r!=e),n.changePermission("allowedEntities",o),t.reply(`Removed entity ${e} to the allowed entities of the region your currently standing in`)});var gt=(r=>(r[r.member=0]="member",r[r.admin=1]="admin",r[r.moderator=2]="moderator",r[r.builder=3]="builder",r))(gt||{});var To=t=>isNaN(Number(t))===!1;function Po(t){return Object.keys(t).filter(To).map(e=>t[e])}var yt=new u({name:"role",description:"Changes the role for a player",requires:t=>m(t)=="admin"||ge(t)});yt.literal({name:"set",description:"Sets the role for a player"}).argument(new p.playerName("playerName")).argument(new p.array("role",Po(gt))).executes((t,e,n)=>{te(e,n),t.reply(`Changed role of ${e} to ${n}`)});yt.literal({name:"get",description:"Gets the role of a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=m(e);t.reply(`${e} has role: ${n}`)});var ht=yt.literal({name:"owner",description:"Manages the owner"});ht.literal({name:"get",description:"Gets the owner of the world"}).executes(t=>{let e=rt(),n=s.ids.collection(),o=Object.keys(n).find(r=>n[r]===e);t.reply(`\xA7aServer Owner: ${o} (id: ${e})`)});ht.literal({name:"transfer",description:"Transfers the owner of the world",requires:t=>ge(t)}).argument(new p.player).executes((t,e)=>{G(t.sender,`Are you sure you want to transfer the server ownership to ${e.name}, this action is not reversible!`,()=>{ye(e),t.reply(`\xA7aSet the server Owner to: ${e.name} (id: ${e.id})`)}),t.reply("\xA7aClose chat to confirm")});ht.literal({name:"clear",description:"clear's the owner of the world",requires:t=>ge(t)}).executes(t=>{G(t.sender,"Are you sure you want to clear the server owner, this action is not reversible!",()=>{ye(null),t.reply('\xA7aCleared the server owner! run "/reload" or reload world to run "/function start" again!')}),t.reply("\xA7aClose chat to confirm")});import{ActionFormData as Ao}from"@minecraft/server-ui";var L=class{constructor(e,n){this.title=e,this.body=n,this.form=new Ao,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,o){return this.buttons.push({text:e,iconPath:n,callback:o}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{ModalFormData as xo}from"@minecraft/server-ui";var Fe=class{constructor(e,n,o){this.form=e,this.player=n,this.callback=o}error(e){new X("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var x=class{constructor(e){this.title=e,this.form=new xo,e&&this.form.title(e),this.args=[],this.triedToShow=0}addDropdown(e,n,o){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,o),this}addSlider(e,n,o,r,i){return this.args.push({type:"slider"}),this.form.slider(e,n,o,r,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,o){return this.args.push({type:"textField"}),this.form.textField(e,n,o),this}show(e,n){this.form.show(e).then(o=>{if(o.canceled){if(o.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e,n)}return}n(new Fe(this,e,n),...o.formValues.map((r,i)=>this.args[i].type=="dropdown"?this.args[i].options[r]:r))})}};function Tn(t){new L("Manage Banned Items").addButton("Remove a Banned Item",null,()=>{No(t)}).addButton("Ban an item",null,()=>{Bo(t)}).show(t)}function No(t){new x("Remove Banned Items").addDropdown("Select item to remove",C("banned_items")).show(t,(e,n)=>{let o=C("banned_items");o=o.filter(r=>r!=n),W("banned_items",o),t.tell(`Removed Banned item "${n}"`)})}function Bo(t){new x("Add Banned Item").addTextField("Item Id","minecraft:string").show(t,(e,n)=>{let o=C("banned_items");if(o.includes(n))return e.error(`\xA7cItem "${n}" is already banned`);o.push(n),W("banned_items",o),t.tell(`Banned the item "${n}"`)})}function Pn(t){new L("Manage Banned Blocks").addButton("Remove a Banned Block",null,()=>{Ro(t)}).addButton("Ban an block",null,()=>{Do(t)}).show(t)}function Ro(t){new x("Remove Banned Block").addDropdown("Select block to remove",C("banned_blocks")).show(t,(e,n)=>{let o=C("banned_blocks");o=o.filter(r=>r!=n),W("banned_blocks",o),t.tell(`Removed Banned block "${n}"`)})}function Do(t){new x("Add Banned Block").addTextField("Block Id","minecraft:barrier").show(t,(e,n)=>{let o=C("banned_blocks");if(o.includes(n))return e.error(`\xA7cBlock "${n}" is already banned`);o.push(n),W("banned_blocks",o),t.tell(`Banned the block "${n}"`)})}function An(t){new x("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(Be),0).addTextField("Level (number)","5").show(t,(e,n,o)=>{if(isNaN(o))return e.error(`\xA7c"${o}" is not a number, please enter a value like, "3", "9", etc.`);let r=parseInt(o),i=C("enchantments");i[n]=r,W("enchantments",i),t.tell(`Set max level for ${n} to ${r}`)})}function xn(t){new x("Manage Appeal Link").addTextField("Appeal Link",Re).show(t,(e,n)=>{W("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function Nn(t){let e=new L("Manage Protections");for(let n of Object.values(_e))e.addButton(n.name,n.iconPath,()=>{_o(n,t)});e.addButton("Back","textures/ui/arrow_dark_left_stretch.png",()=>{ze(t)}).show(t)}function _o(t,e){let n=t.getConfig(),o=new x(`Manage ${t.name} Protection Config`).addToggle("Enabled",n.enabled),r=[];for(let[i,a]of Object.entries(t.configDefault))r.push(i),typeof a.defaultValue=="boolean"?o.addToggle(a.description,n[i]):typeof a.defaultValue=="number"?o.addSlider(a.description,0,100,1,n[i]):o.addTextField(a.description,null,n[i]);o.show(e,(i,a,...c)=>{a!=n.enabled&&(a&&t.enable(),a||t.disable());let l={enabled:a};for(let[f,g]of Object.keys(t.configDefault).entries())l[g]=c[f];t.setConfig(l),e.tell(`Updated config for ${t.name}!`)})}function ze(t){new L("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{Nn(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{Tn(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{Pn(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{An(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{xn(t)}).show(t)}new u({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(m(t))}).executes(t=>{ze(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as Bn}from"@minecraft/server";function Rn(t,e){if(t.hasTag("spectator")){if(t.runCommandAsync("gamemode c"),t.triggerEvent("removeSpectator"),t.removeTag("spectator"),!e)return;Bn.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommandAsync("gamemode spectator"),t.triggerEvent("addSpectator"),t.addTag("spectator"),!e)return;Bn.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new u({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>m(t)=="admin"}).executes(t=>{Rn(t.sender,!1)}).boolean("say").executes((t,e)=>{Rn(t.sender,e)});new u({name:"version",description:"Get Current Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${Zt}`)});new u({name:"kick",description:"Kicks a player from the game",requires:t=>m(t)=="admin"}).argument(new p.player).string("reason").executes((t,e,n)=>{$(e,[n]),t.reply(`\xA7aKicked ${e.name} from world`)});var q=class{constructor(e){this.data=e,console.warn(`[LOG]: ${e.message}`),s.logs.set(Date.now().toString(),e)}};function bt(t){var e=6e4,n=e*60,o=n*24,r=o*30,i=o*365,a=Date.now()-t;return a<e?Math.round(a/1e3)+" seconds ago":a<n?Math.round(a/e)+" minutes ago":a<o?Math.round(a/n)+" hours ago":a<r?"approximately "+Math.round(a/o)+" days ago":a<i?"approximately "+Math.round(a/r)+" months ago":"approximately "+Math.round(a/i)+" years ago"}var Ce=new u({name:"log",description:"Manages the log command",requires:t=>m(t)=="admin"});Ce.literal({name:"add",description:"Adds a new log"}).string("message").executes((t,e)=>{new q({message:e}),t.reply(`\xA7aAdded new log: ${e}`)});Ce.literal({name:"getAll",description:"Gets all logs sorted in descending"}).int("page").array("order",["ascending","descending"]).executes((t,e,n)=>{let o=Object.entries(s.logs.collection()).sort((i,a)=>n=="ascending"?parseInt(a[0])-parseInt(i[0]):parseInt(i[0])-parseInt(a[0]));if(o.length==0)return t.reply("\xA7cNo Logs have been made!");let r=Math.ceil(o.length/8);e>r&&(e=r),t.reply(`\xA72--- Showing logs page ${e} of ${r} (${S}log getAll <page: int>) ---`);for(let[i,a]of o.slice(e*8-8,e*8))t.reply(`${bt(parseInt(i))}: ${a.message}`)});Ce.literal({name:"getPlayersLogs",description:"Gets all logs associated with a player"}).argument(new p.playerName).int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(s.logs.collection()).filter(a=>a[1].playerName==e).sort((a,c)=>o=="ascending"?parseInt(c[0])-parseInt(a[0]):parseInt(a[0])-parseInt(c[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for "${e}" page ${n} of ${i} ---`);for(let[a,c]of r.slice(n*8-8,n*8))t.reply(`${bt(parseInt(a))}: ${c.message}`)});Ce.literal({name:"getProtectionLogs",description:"Gets all logs associated with a protection"}).string("protection").int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(s.logs.collection()).filter(a=>a[1].protection==e).sort((a,c)=>o=="ascending"?parseInt(c[0])-parseInt(a[0]):parseInt(a[0])-parseInt(c[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for protection: "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for Protection: "${e}" page ${n} of ${i} ---`);for(let[a,c]of r.slice(n*8-8,n*8))t.reply(`${bt(parseInt(a))}: ${c.message}`)});Ce.literal({name:"clearAll",description:"Clears all logs"}).executes(t=>{s.logs.clear(),t.reply("\xA7aCleared All logs!")});var Oo=new u({name:"teleport",description:"Teleports entities (players, mobs, etc.).",aliases:["tp"],requires:t=>m(t)=="admin"});Oo.argument(new p.player).location("destination").executes((t,e,n)=>{e.addTag("skip-movement-check"),e.teleport(n,e.dimension,0,0),t.reply(`Teleported ${e.name} to ${n.x} ${n.y} ${n.z}`)});F(t=>{try{let e=s.bans.get(t.id);if(!e)return;if(e.expire&&e.expire<Date.now())return s.bans.delete(t.id);$(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?ee(e.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${C("appealLink")}`],()=>{console.warn(new Error("Failed to kick player")),s.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as $o}from"@minecraft/server";F(t=>{try{let e=s.freezes.get(t.id);if(!e)return t.getComponent("movement").resetToDefaultValue();t.getComponent("movement").setCurrent(0),t.teleport(new $o(e.location.x,e.location.y,e.location.z),h[e.location.dimension],0,0)}catch{}},200);import{world as Fo}from"@minecraft/server";var kt={};Fo.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(S))for(let e of Object.values(kt))e.callback(t)});var Ve=class{static subscribe(e){let n=Date.now();return kt[n]={callback:e},n}static unsubscribe(e){delete kt[e]}};Ve.subscribe(t=>{let e=B.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return s.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(T["modules.managers.mute.isMuted"]())}});import{BlockLocation as zo,system as Dn,world as It}from"@minecraft/server";Dn.runSchedule(()=>{xe()},6e3);It.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(m(t.source)))return;let e=y.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);Ut.includes(n.typeId)&&e.permissions.doorsAndSwitches||Yt.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});It.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(y.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});It.events.entityCreate.subscribe(async({entity:t})=>{let e=await y.blockLocationInRegionSync(new zo(t.location.x,t.location.y,t.location.z),t.dimension.id);!e||e.permissions.allowedEntities.includes(t.typeId)||(t.teleport({x:0,y:-64,z:0},t.dimension,0,0),t.kill())});Dn.runSchedule(async()=>{for(let t of await y.getAllRegionsSync())for(let e of h[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntities}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100);F(async t=>{for(let e of await y.getAllRegionsSync())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as Vo}from"@minecraft/server";Vo.events.playerJoin.subscribe(async({player:t})=>{if(await ce(),De()&&await ot(t)!="admin")return $(t,T["lockdown.kick.message"]());B.getMuteData(t)&&t.runCommandAsync("ability @s mute true"),s.ids.has(t.name)?t.addTag("old"):s.ids.set(t.name,t.id);let e=R.getPlayersRoleToSet(t.name);e&&te(t,e)});import{Items as jo,MinecraftItemTypes as _,world as wt}from"@minecraft/server";var Ln=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],Go=[10,11,12,13,14,15,16,19,20,21,22,23,24,25,28,29,30,31,32,33,34,37,38,39,40,41,42,43];function Ho(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,w);continue}o.setItem(r,i.item.itemStack)}for(let[r,i]of[...wt.getPlayers()].entries()){let a=Ln[r],c=new v(_.skull,{nameTag:i.name,data:3});o.setItem(a,c.itemStack),e.slots[a]={item:c,action:l=>{l.PageAction("moderation:see_inventory",{name:i.name})}}}}function Ko(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let l=0;l<o.size;l++){let f=e.slots[l];if(!f||!f.item){o.setItem(l,w);continue}o.setItem(l,f.item.itemStack)}let r=new v(_.enderChest,{nameTag:`\xA7eView \xA7f${n?.name}\xA7e Ender Chest
\xA7fNote: \xA7cThis will not grab \xA7lANY NBT!\xA7r`});o.setItem(49,r.itemStack),e.slots[49]={item:r,action:l=>{l.PageAction("moderation:see_ender_chest",{name:n.name})}};let i=[...wt.getPlayers()].find(l=>l.name==n.name);i||(Object.values(A).find(f=>f.entity.id==t.id).despawn(),i.tell(`"${n.name}" Could not be found, Gui Crashed`));let a=i.getComponent("inventory").container,c=0;for(let l=0;l<a.size;l++){let f=a.getItem(l),g=Ln[c];if(c++,!f){o.setItem(g,w);continue}o.setItem(g,f),e.slots[g]={item:new v(jo.get(f.typeId),{amount:f.amount,data:f.data},f),action:async no=>{l<9?await i.runCommandAsync(`replaceitem entity @s slot.hotbar ${l} air`):await i.runCommandAsync(`replaceitem entity @s slot.inventory ${l-9} air`),no.GiveAction(),e.slots[g]={item:null,action:oo=>{a.addItem(oo.getItemAdded())}}}}}}async function Uo(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let c=0;c<o.size;c++){let l=e.slots[c];if(!l||!l.item){o.setItem(c,w);continue}o.setItem(c,l.item.itemStack)}let r=[...wt.getPlayers()].find(c=>c.name==n?.name);r||(Object.values(A).find(l=>l.entity.id==t.id).despawn(),r.tell(`"${n.name}" Could not be found, Gui Crashed`));let i=0,a=Object.values(_);for(let c of a)try{await r.runCommandAsync(`testfor @s[hasitem={item=${c.id},location=slot.enderchest}]`);let l=new v(c,{nameTag:"Note: \xA7l\xA7cThis is not the exact item"}),f=Go[i];o.setItem(f,l.itemStack),e.slots[f]={item:l,action:g=>{g.GiveAction(),e.slots[f]=null}},i++}catch{}}new V("moderation:see",Ho).setSlots([50],new v(_.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new v(_.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new V("moderation:see_inventory",Ko).setSlots([50],new v(_.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new v(_.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new V("moderation:see_ender_chest",Uo).setSlots([50],new v(_.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new v(_.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{Player as Yo,MinecraftBlockTypes as Wo}from"@minecraft/server";import{system as _n,world as Mn}from"@minecraft/server";var I=class{constructor(e,n,o){this.name=e;this.description=n;this.iconPath=o;this.name=e,this.description=n,this.iconPath=o,this.configDefault={},this.isEnabled=!1,this.events={},this.schedules=[],this.forEachValidPlayers=[],_e[this.name]=this}setConfigDefault(e){return this.configDefault=e,s.protections.hasSync(this.name).then(n=>{if(n)return;let o={enabled:!0};for(let r of Object.keys(e))o[r]=e[r].defaultValue;s.protections.set(this.name,o)}),this}getConfig(){let e=s.protections.get(this.name);return e||(e={enabled:this.isEnabled}),e}async getConfigSync(){let e=await s.protections.getSync(this.name);return e||(e={enabled:this.isEnabled}),e}async setConfig(e){await s.protections.set(this.name,e)}triggerChange(e){if(e){this.isEnabled=!0,this.onEnableCallback?.();for(let[n,o]of Object.entries(this.events)){if(o.triggered)continue;let r=Mn.events[n].subscribe(o.callback);o.triggered=!0,o.callback=r}for(let n of this.forEachValidPlayers){if(n.key)continue;let o=F(n.callback,n.delay);n.key=o}for(let n of this.schedules){if(n.runScheduleId)continue;let o=_n.runSchedule(n.callback);n.runScheduleId=o}}else{this.isEnabled=!1,this.onDisableCallback?.();for(let[n,o]of Object.entries(this.events))!o.triggered||(Mn.events[n].unsubscribe(o.callback),o.triggered=!1);for(let n of this.forEachValidPlayers)!n.key||(rn(n.key),n.key=null);for(let n of this.schedules)!n.runScheduleId||(_n.clearRunSchedule(n.runScheduleId),n.runScheduleId=null)}}onEnable(e){return this.onEnableCallback=e,this}onDisable(e){return this.onDisableCallback=e,this}subscribe(e,n){return this.events[e]={callback:n,triggered:!1},this}runSchedule(e,n){return this.schedules.push({callback:e,tickInterval:n,runScheduleId:null}),this}forEachValidPlayer(e,n=0){return this.forEachValidPlayers.push({callback:e,delay:n,key:null}),this}enable(){this.triggerChange(!0)}disable(){this.triggerChange(!1)}};var qo=["minecraft:command_block_minecart"],ve=new I("cbe","Stops CBE","textures/blocks/command_block.png").setConfigDefault({entityCreate:{description:"Adds NPC protection",defaultValue:!0},banSpawnEggs:{description:"If spawn eggs should be banned",defaultValue:!0}});ve.subscribe("entityCreate",async({entity:t})=>{if(!(await ve.getConfigSync()).entityCreate)return;let n=()=>{try{t.triggerEvent("despawn"),t.kill()}catch{t.kill()}};if(qo.includes(t.typeId)||t.typeId=="minecraft:npc"&&!re.isValid(t))return n()});ve.subscribe("beforeItemUseOn",t=>{if(!(t.source instanceof Yo)||["admin","moderator"].includes(m(t.source)))return;let e=ve.getConfig();if(t.item.typeId.endsWith("spawn_egg")){if(!e.banSpawnEggs||t.source.dimension.getBlock(t.blockLocation).typeId==Wo.mobSpawner.id)return;t.cancel=!0,t.source.tell("\xA7c[Rubedo]: You cannot place spawnEggs on the floor!"),t.source.playSound("note.bass")}else{if(Jt.includes(t.item.typeId)){t.cancel=!0;return}if(!C("banned_blocks").includes(t.item.typeId))return;t.cancel=!0,new P(t.source,null,"Placing Banned Blocks")}});ve.enable();var Ct=32e4;new I("crasher","Protection against type 1 crasher","textures/ui/servers.png").forEachValidPlayer(t=>{(Math.abs(t.location.x)>Ct||Math.abs(t.location.y)>Ct||Math.abs(t.location.z)>Ct)&&new P(t,null,"Crasher detected")}).enable();import{GameMode as Xo,world as Jo}from"@minecraft/server";var Qo=Xo.creative,On=new k,vt=new I("gamemode","Blocks illegal gamemode","textures/ui/creative_icon.png").setConfigDefault({clearPlayer:{description:"Whether to clear players inventory.",defaultValue:!0},setToSurvival:{description:"If player should be set to survival after being flagged.",defaultValue:!0},banPlayer:{description:"If player should be banned after violation count is met.",defaultValue:!1},violationCount:{description:"The amount of violations before ban.",defaultValue:0}});vt.runSchedule(async()=>{let t=await vt.getConfigSync();for(let e of Jo.getPlayers({gameMode:Qo})){if(["moderator","admin","builder"].includes(m(e)))continue;try{t.setToSurvival&&e.runCommandAsync("gamemode s"),t.clearPlayer&&e.runCommandAsync("clear @s")}catch{}let n=(On.get(e)??0)+1;On.set(e,n),t.banPlayer&&n>=t.violationCount&&new P(e,null,"Illegal Gamemode")}},20);vt.enable();import{world as tr,Location as nr,system as or}from"@minecraft/server";import{system as Zo,world as er}from"@minecraft/server";var je=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var Ge={};Zo.runSchedule(()=>{Ge={};for(let t of er.getPlayers()){if(t.dimension.id!="minecraft:overworld")continue;let e=Lt(t.location),n=e.offset(Y.x,Y.y,Y.z),o=e.offset(-Y.x,-Y.y,-Y.z);for(let r of n.blocksBetween(o)){if(r.y<-64)continue;let i=t.dimension.getBlock(r);!i||!Ne.includes(i.typeId)||(Ge[JSON.stringify(r)]=new je(i.getComponent("inventory").container))}}},100);var Et={};tr.events.blockBreak.subscribe(t=>{for(let e of Object.values(Et))e.callback(new St(t.block,t.brokenBlockPermutation,t.dimension,t.player))});var Ee=class{static subscribe(e){let n=Date.now();return Et[n]={callback:e},n}static unsubscribe(e){delete Et[e]}},St=class{constructor(e,n,o,r){this.block=e;this.brokenBlockPermutation=n;this.dimension=o;this.player=r;this.block=e,this.brokenBlockPermutation=n,this.dimension=o,this.player=r}set cancel(e){if(this.dimension.getBlock(this.block.location).setPermutation(this.brokenBlockPermutation.clone()),Ne.includes(this.brokenBlockPermutation.type.id)){let n=Ge[JSON.stringify(this.block.location)];n&&n.load(this.block.getComponent("inventory").container)}or.run(()=>{[...this.dimension.getEntities({maxDistance:2,type:"minecraft:item",location:new nr(this.block.location.x,this.block.location.y,this.block.location.z)})].forEach(n=>n.kill())})}};var $n=new k,rr=15,ir=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area"],sr=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],Fn=new k,zn=null,Tt=new I("nuker","Blocks block breaking too fast","textures/blocks/dirt.png").setConfigDefault({banPlayer:{description:"If the player should be banned once violation count is met",defaultValue:!1},violationCount:{description:"Violations before ban",defaultValue:0}});Tt.onEnable(async()=>{let t=await Tt.getConfigSync();zn=Ee.subscribe(e=>{if(["moderator","admin"].includes(m(e.player))||e.block.getTags().some(o=>ir.includes(o)))return;let n=$n.get(e.player);if($n.set(e.player,Date.now()),!!n){if(!sr.includes(e.block.typeId)){if(n<Date.now()-rr)return;let o=(Fn.get(e.player)??0)+1;Fn.set(e.player,o),t.banPlayer&&o>=t.violationCount&&new P(e.player,null,"Using Nuker")}e.cancel=!0}})}).onDisable(()=>{Ee.unsubscribe(zn)});Tt.enable();var Vn=new k,jn=new k,Pt=new I("spam","Blocks spam in chat","textures/ui/mute_on.png").setConfigDefault({permMutePlayer:{description:"If player should be permanently muted once violation count is met.",defaultValue:!1},violationCount:{description:"Violation count before permanent mute",defaultValue:0},repeatedMessages:{description:"Blocks repeated messages",defaultValue:!0},zalgo:{description:"Blocks zalgo",defaultValue:!0}});Pt.subscribe("beforeChat",t=>{try{if(t.message.startsWith(S)||["admin","moderator"].includes(m(t.sender)))return;let e=Pt.getConfig(),n=()=>{let o=(jn.get(t.sender)??0)+1;jn.set(t.sender,o),e.permMutePlayer&&o>=e.violationCount&&new B(t.sender,null,"Spamming")};if(e.repeatedMessages&&Vn.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");Vn.set(t.sender,t.message)}catch(e){console.warn(e+e.stack)}});Pt.enable();var Gn=new k;function He(t,e){let n=t.getComponent("inventory").container,o=n.getItem(e),r=C("cbe_config");if(r.clearItem&&n.setItem(e,w),new q({playerName:t.name,message:`${t.name} Has obtained a unobtainable item: ${o.typeId}`,protection:"unobtainable"}),!r.banPlayer)return;let i=(Gn.get(t)??0)+1;Gn.set(t,i),!(i<r.violationCount)&&new P(t,null,"Possession of Unobtainable item")}new I("unobtainable","Blocks unobtainable items","textures/blocks/end_portal.png").forEachValidPlayer(t=>{let e=C("banned_items"),n=t.getComponent("inventory").container;for(let o=0;o<n.size;o++){let r=n.getItem(o);if(!r)continue;if(e.includes(r.typeId))return He(t,o);if(qt.includes(r.typeId))return new q({playerName:t.name,message:`${t.name} Has obtained a Forbidden item: ${r.typeId}`,protection:"unobtainable"}),n.setItem(o,w);let i=[];for(let a of r.getComponent("enchantments").enchantments){let c=sn(a);if(a.level>c||a.level<1||i.includes(a.type.id))return He(t,o);i.push(a.type.id)}}}).enable();import{MinecraftBlockTypes as E,MinecraftEntityTypes as ar,MinecraftItemTypes as j,Player as cr}from"@minecraft/server";var lr=[E.chest.id,E.trappedChest.id,E.barrel.id,E.dispenser.id,E.dropper.id,E.furnace.id,E.litFurnace.id,E.blastFurnace.id,E.litBlastFurnace.id,E.smoker.id,E.litSmoker.id,E.hopper.id,E.beehive.id,E.beeNest.id,E.mobSpawner.id],mr=[j.chestBoat.id,j.oakChestBoat.id,j.birchChestBoat.id,j.acaciaChestBoat.id,j.jungleChestBoat.id,j.spruceChestBoat.id,j.darkOakChestBoat.id,j.mangroveChestBoat.id];new I("nbt","Blocks illegal nbt on items","textures/ui/icon_random.png").subscribe("blockPlace",async({block:t})=>{if(!lr.includes(t.typeId))return;let e=t.permutation;await t.dimension.runCommandAsync(`setblock ${t.x} ${t.y} ${t.z} ${t.typeId}`),t.setPermutation(e)}).subscribe("beforeItemUseOn",t=>{t.source instanceof cr&&(!mr.includes(t.item.typeId)||(t.cancel=!0,t.source.dimension.spawnEntity(ar.chestBoat.id,t.blockLocation.above()),an(t.source)!="creative"&&t.source.getComponent("inventory").container.setItem(t.source.selectedSlot,w)))}).enable();import{MinecraftEffectTypes as fr,MinecraftItemTypes as Qn,Player as Nt}from"@minecraft/server";import{world as Hn}from"@minecraft/server";var At={};function ur(t,e){return!(t.x!=e.x||t.y!=e.y||t.z!=e.z)}var xt=new k;Hn.events.tick.subscribe(t=>{let e=(n,o)=>{for(let r of Object.values(At))r.callback(n,o)};for(let n of Hn.getPlayers()){let o=xt.get(n);o&&ur(n.location,o.location)||(xt.set(n,{location:n.location,dimension:n.dimension,tickSet:t.currentTick}),o&&e(n,o))}});var M=class{static subscribe(e){let n=Date.now();return At[n]={callback:e},n}static unsubscribe(e){delete At[e]}static delete(e){xt.delete(e)}};var Kn={walk:{velocity:.17,distance:.23},run:{velocity:.19,distance:.35}},Un=.056,Yn=10,Wn=["gliding","riding"];var qn=new k;function pr(t,e){return Math.hypot(e.x-t.x,e.z-t.z)}function gr(t){return(t.getEffect(fr.speed)?.amplifier??0)*Un}function yr(t,e){let n=gr(e),o=Kn.run.distance+.8;return t>n+o}function Xn(t,e){let n=(qn.get(t)??0)+1;qn.set(t,n),M.delete(t),!(n<3)&&t.teleport(e.location,e.dimension,t.rotation.x,t.rotation.y)}var Jn=null,Se=new I("movement","Blocks illegal movements on players","textures/ui/move.png").setConfigDefault({tpCheck:{description:"If teleports should be flagged",defaultValue:!0}});Se.onEnable(async()=>{console.warn("enabled movement protection");let t=await Se.getConfigSync();Jn=M.subscribe((e,n)=>{if(m(e)=="admin"||e.dimension.id!=n.dimension.id||e.getTags().some(r=>Wn.includes(r)))return;let o=pr(e.location,n.location);if(e.hasTag("skip-movement-check"))return e.removeTag("skip-movement-check");if(o>Yn){if(!t.tpCheck)return;Xn(e,n)}else{if(!yr(o,e))return;Xn(e,n)}})}).onDisable(()=>{console.warn("disabled movement protection"),M.unsubscribe(Jn)});Se.subscribe("dataDrivenEntityTriggerEvent",t=>{t.entity instanceof Nt&&t.id=="on_death"&&M.delete(t.entity)});Se.subscribe("projectileHit",({projectile:t,source:e})=>{t.typeId==Qn.enderPearl.id&&e instanceof Nt&&M.delete(e)});Se.subscribe("itemCompleteCharge",({itemStack:t,source:e})=>{t.typeId==Qn.chorusFruit.id&&e instanceof Nt&&M.delete(e)});import{MinecraftEffectTypes as hr,Player as br,world as Zn}from"@minecraft/server";var kr=Zn.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(!(t.entity instanceof br)||t.id!="rubedo:becomeAdmin")return;t.entity.removeTag("CHECK_PACK");let e=on();if(e)return t.entity.playSound("note.bass"),t.entity.tell(`\xA7cFailed to give server owner: "${e}" is already owner!`),Zn.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(kr);te(t.entity,"admin"),ye(t.entity),t.entity.addEffect(hr.blindness,3,255,!0),t.entity.tell('\xA7aYou have now been set as the "owner" of this server. The command "/function start" will not do anything anymore, type "-help" for more information!')});import{system as Ir}from"@minecraft/server";Ir.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});import{DynamicPropertiesDefinition as Bt,EntityTypes as wr,MinecraftEntityTypes as Cr,world as to}from"@minecraft/server";var eo=[];to.events.worldInitialize.subscribe(({propertyRegistry:t})=>{h.overworld.runCommandAsync(`tickingarea add ${N.x} ${N.y} ${N.z} ${N.x} ${N.y} ${N.z} db true`);let e=new Bt;e.defineString("tableName",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,wr.get(ie));let n=new Bt;n.defineString("role",30),t.registerEntityTypeDynamicProperties(n,Cr.player);let o=new Bt;o.defineString("worldsOwner",100),o.defineBoolean("isLockDown"),t.registerWorldDynamicProperties(o);for(let r of eo)to.scoreboard.addObjective(r.objective,r.displayName??"")});var $e=[];function vn(){$e=[]}console.warn("----- Importing Plugins -----");console.warn("---- STARTING RUBEDO ----");var w=new vr(Er.stick,0),Te=!1;function Ue(){Te=!0}export{w as AIR,Te as WORLD_IS_LOADED,Ue as setWorldIsLoaded};
//# sourceMappingURL=index.js.map

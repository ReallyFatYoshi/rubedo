import{ItemStack as Tr,MinecraftItemTypes as Pr,system as Ar}from"@minecraft/server";import{world as co}from"@minecraft/server";var T="-";import{world as so}from"@minecraft/server";import{ItemStack as _t,MinecraftItemTypes as Ot}from"@minecraft/server";import{BlockLocation as oo}from"@minecraft/server";var Pt=32e3,ae="rubedo:database",B=new oo(0,-64,0),At=128;import{system as Dt,world as Lt}from"@minecraft/server";import{BlockLocation as Ue,MinecraftDimensionTypes as ee,system as xt,world as te}from"@minecraft/server";import{MessageFormData as ro}from"@minecraft/server-ui";var Z=class{constructor(e,n){this.title=e,this.body=n,this.form=new ro,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};var h={overworld:te.getDimension(ee.overworld),nether:te.getDimension(ee.nether),theEnd:te.getDimension(ee.theEnd),"minecraft:overworld":te.getDimension(ee.overworld),"minecraft:nether":te.getDimension(ee.nether),"minecraft:the_end":te.getDimension(ee.theEnd)};function le(t){let e=t.split(",");console.warn(e.length);let n=0;for(let o of e){let r=parseInt(o.match(/\D+|\d+/g)[0]),i=o.match(/\D+|\d+/g)[1];i=="y"&&(n=n+317098e-16*r),i=="w"&&(n=n+6048e5*r),i=="d"&&(n=n+864e5*r),i=="h"&&(n=n+36e5*r),i=="m"&&(n=n+6e4*r),i=="s"&&(n=n+1e3*r),i=="ms"&&(n=n+r)}return n}function ne(t){return new Date(t).toString()}function Rt(t){return new Ue(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}function K(t,e,n,o=()=>{}){new Z("Confirm To Continue",e).setButton1("Confirm",n).setButton2("Never Mind",o).show(t)}function Bt(t){return new Promise(e=>{let n=xt.runSchedule(()=>{e(),xt.clearRunSchedule(n)},t)})}function Nt(t,e){let n=[t.x,t.y,t.z],o=[t.x,t.y,t.z];return(t instanceof Ue||e instanceof Ue)&&(n=n.map(r=>Math.trunc(r)),o=o.map(r=>Math.trunc(r))),!n.find((r,i)=>o[i]!=r)}function io(t,e){let{x:n,y:o,z:r}=t,{x:i,y:s,z:c}=e,l=n<i?n:i,d=o<s?o:s,g=r<c?r:c,J=n<i?i:n,He=o<s?s:o,no=r<c?c:r;return[{x:l,y:d,z:g},{x:J,y:He,z:no}]}function Te(t,e,n){let[{x:o,y:r,z:i},{x:s,y:c,z:l}]=io(e,n),{x:d,y:g,z:J}=t;return d>=o&&d<=s&&g>=r&&g<=c&&J>=i&&J<=l}function Mt(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}var H={},Pe=!1;Dt.run(async()=>{try{await h.overworld.runCommandAsync("testfor @a"),Pe=!0;for(let[t,e]of Object.entries(H))e(),delete H[t]}catch{let e=Lt.events.entityCreate.subscribe(n=>{Dt.run(()=>{Pe=!0;for(let[o,r]of Object.entries(H))r(),delete H[o];Lt.events.entityCreate.unsubscribe(e)})})}});var I=class{static async awaitLoad(){if(!Pe)return new Promise(e=>{I.subscribe(e)})}static subscribe(e){if(Pe){e();return}let n=Object.keys(H).length;return H[n]=e,n}static unsubscribe(e){delete H[e]}};var b=class{constructor(e){this.tableName=e;this.tableName=e,this.MEMORY=null,this.QUEUE=[],I.subscribe(async()=>{await this.initData(),this.QUEUE.forEach(n=>n())})}static createTableEntity(e,n){let o=h.overworld.spawnEntity(ae,B);return o.setDynamicProperty("tableName",e),o.nameTag=`\xA7aDatabase Table: ${e}\xA7r`,n&&o.setDynamicProperty("index",n),o}static getTableEntities(e){return h.overworld.getEntitiesAtBlockLocation(B).filter(n=>n.typeId==ae&&n.getDynamicProperty("tableName")==e)}async addQueueTask(){return new Promise(e=>{this.QUEUE.push(e)})}async saveData(){this.MEMORY||await this.addQueueTask();let e=b.getTableEntities(this.tableName),n=Mt(JSON.stringify(this.MEMORY),Pt),o=Math.ceil(n.length/At)-e.length;if(o>0)for(let r=0;r<o;r++)e.push(b.createTableEntity(this.tableName));for(let[r,i]of e.entries()){let s=i.getComponent("inventory").container;for(let[c,l]of n.entries()){if(!l)continue;if(c>s.size-1)break;let d=new _t(Ot.acaciaBoat);d.nameTag=l,s.setItem(c,d),n[c]=null}for(let c=n.length+1;c<s.size;c++)s.setItem(c,new _t(Ot.stick,0));if(i.setDynamicProperty("index",r),e[r]=null,!n.find(c=>c))break}e.filter(r=>r).forEach(r=>r.triggerEvent("despawn"))}async initData(){let e=b.getTableEntities(this.tableName).sort((r,i)=>r.getDynamicProperty("index")-i.getDynamicProperty("index")),n="";for(let r of e){let i=r.getComponent("inventory").container;for(let s=0;s<i.size;s++){let c=i.getItem(s);!c||(n=n+c.nameTag)}}let o=n==""?{}:JSON.parse(n);return this.MEMORY=o,o}async set(e,n){return this.MEMORY[e]=n,this.saveData()}get(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `getAsync` instead!");return this.MEMORY[e]}async getSync(e){return this.MEMORY?this.get(e):(await this.addQueueTask(),this.MEMORY[e])}keys(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `keysSync` instead!");return Object.keys(this.MEMORY)}async keysSync(){return this.MEMORY?this.keys():(await this.addQueueTask(),Object.keys(this.MEMORY))}values(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `valuesSync` instead!");return Object.values(this.MEMORY)}async valuesSync(){return this.MEMORY?this.values():(await this.addQueueTask(),Object.values(this.MEMORY))}has(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `hasSync` instead!");return Object.keys(this.MEMORY).includes(e)}async hasSync(e){return this.MEMORY?this.has(e):(await this.addQueueTask(),Object.keys(this.MEMORY).includes(e))}collection(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `collectionSync` instead!");return this.MEMORY}async collectionSync(){return this.MEMORY?this.collection():(await this.addQueueTask(),this.MEMORY)}async delete(e){let n=delete this.MEMORY[e];return await this.saveData(),n}async clear(){return this.MEMORY={},await this.saveData()}};var a={config:new b("config"),freezes:new b("freezes"),mutes:new b("mutes"),bans:new b("bans"),regions:new b("regions"),roles:new b("roles"),tasks:new b("tasks"),npcs:new b("npcs"),ids:new b("ids"),logs:new b("logs"),protections:new b("protections")};function $t(t){return[...so.getPlayers()].find(e=>e.name===t)}var F=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},me=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},ue=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},qe=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be valid float!"}},U=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},de=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},We=class{constructor(e="player"){this.name=e;this.typeName="Player";this.name=e}matches(e){return{success:!!$t(e),value:$t(e)}}fail(e){return`player: "${e}", is not in this world`}},Qe=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a valid target`}},fe=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Xe=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},Je=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!a.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},p={string:me,int:ue,float:qe,location:U,boolean:de,player:We,target:Qe,array:fe,duration:Xe,playerName:Je};var Ae=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function Ft(t,e){try{return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}catch{return[]}}function zt(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function Ze(t,e){t.tell({rawtext:[{text:e.data.invalidPermission?e.data.invalidPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function Vt(t,e,n,o,r){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${T}${e.data.name} ${o.slice(0,r).join(" ")}`,o[r]??" ",o.slice(r+1).join(" ")]}]}),n.children.length>1||!o[r]){let i=n.children.map(s=>s.type instanceof F?s.type.name:s.type?.typeName);t.tell(`\xA7c"${o[r]??"undefined"}" is not valid! Argument "${[...new Set(n.children.map(s=>s.type.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.tell(`\xA7c${n.children[0]?.type?.fail(o[r])}`)}function ao([t,e,n],{location:o,viewVector:r}){if(!t||!e||!t)return null;let i=[o.x,o.y,o.z],s=[r.x,r.y,r.z],c=[t,e,n].map(d=>{let g=parseFloat(d);return isNaN(g)?0:g}),l=[t,e,n].map((d,g)=>d.includes("~")?c[g]+i[g]:d.includes("^")?c[g]+s[g]:c[g]);return{x:l[0],y:l[1],z:l[2]}}function jt(t,e,n,o){let r=e[e.length-1]??o,i=[];for(let[s,c]of e.entries())if(!c.type.name.endsWith("*")){if(c.type instanceof U){i.push(ao([t[s],t[s+1],t[s+2]],n.sender));continue}c.type instanceof F||i.push(c.type.matches(t[s]).value??t[s])}r.callback(new Ae(n),...i)}var q=[];co.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(T))return;t.cancel=!0;let e=Ft(t.message,T),n=q.find(c=>c.depth==0&&(c.data.name==e[0]||c.data?.aliases?.includes(e[0]))),o={message:t.message,sendToTargets:t.sendToTargets,sender:t.sender,targets:t.targets};if(!n)return zt(t.sender,e[0]);if(!n.data?.requires(t.sender))return Ze(o.sender,n);e.shift();let r=[],i=(c,l)=>{if(c.children.length>0){let d=c.children.find(g=>g.type.matches(e[l]).success);return!d&&!e[l]&&c.callback?void 0:d?d.data?.requires(o.sender)?(r.push(d),i(d,l+1)):(Ze(o.sender,d),"fail"):(Vt(o.sender,n,c,e,l),"fail")}};i(n,0)!="fail"&&jt(e,r,o,n)});import{system as fn,world as Io}from"@minecraft/server";var Yt="rubedo:gui",pe="rubedo:inventory";import{world as D,Player as mo,BlockLocation as Zt,MinecraftBlockTypes as uo,GameMode as fo,system as nt}from"@minecraft/server";import{BlockLocation as Ut,MinecraftBlockTypes as lo}from"@minecraft/server";var Gt={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntities:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},Kt=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],Ht=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box","minecraft:lit_smoker","minecraft:smoker"];var W=[],xe=!1,et=-64,tt=320,y=class{static async getAllRegionsSync(){if(xe)return W;let e=(await a.regions.valuesSync()).map(n=>new y(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{W.push(n)}),xe=!0,e}static getAllRegions(){if(xe)return W;let e=a.regions.values().map(n=>new y(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{W.push(n)}),xe=!0,e}static blockLocationInRegion(e,n){return this.getAllRegions().find(o=>o.dimensionId==n&&Te(e,{x:o.from.x,y:et,z:o.from.z},{x:o.to.x,y:tt,z:o.to.z}))}static async blockLocationInRegionSync(e,n){return(await this.getAllRegionsSync()).find(o=>o.dimensionId==n&&Te(e,{x:o.from.x,y:et,z:o.from.z},{x:o.to.x,y:tt,z:o.to.z}))}static async removeRegionAtBlockLocation(e,n){let o=this.blockLocationInRegion(e,n);return o?a.regions.delete(o.key):!1}constructor(e,n,o,r,i){this.from=e,this.to=n,this.dimensionId=o,this.permissions=r??Gt,this.key=i||Date.now().toString(),i||this.update().then(()=>{Re(),W.push(this)})}async update(){return a.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}async delete(){let e=a.regions.get(this.key),n=new Ut(e.from.x,e.dimensionId=="minecraft:overworld"?-64:0,e.from.z),o=new Ut(e.to.x,e.dimensionId=="minecraft:overworld"?-64:0,e.to.z);for(let r of n.blocksBetween(o))h[e.dimensionId].getBlock(r)?.setType(lo.bedrock);return W=W.filter(r=>r.key!=this.key),a.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&Te(e.location,{x:this.from.x,y:et,z:this.from.z},{x:this.to.x,y:tt,z:this.to.z})}changePermission(e,n){this.permissions[e]=n,this.update()}};var M=class{static getTasks(){return a.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return M.getTasks().find(o=>o.playerName==e)?.role}constructor(e,n){let o=M.getTasks();o.push({playerName:e,role:n}),a.tasks.set("changePlayerRole",o)}};import{MinecraftBlockTypes as ge,MinecraftItemTypes as f}from"@minecraft/server";var qt=[f.beehive.id,f.beeNest.id,f.axolotlBucket.id,f.codBucket.id,f.tadpoleBucket.id,f.tropicalFishBucket.id,f.salmonBucket.id,f.pufferfishBucket.id],Wt=[f.allow.id,f.barrier.id,f.borderBlock.id,f.debugStick?.id??"minecraft:debug_stick",f.deny.id,f.jigsaw.id,f.lightBlock.id,f.commandBlock.id,f.repeatingCommandBlock.id,f.chainCommandBlock.id,f.commandBlockMinecart.id,f.structureBlock.id,f.structureVoid.id,f.bedrock.id,f.endPortalFrame.id,"minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingobsidian","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],Qt=[ge.dispenser.id],Xt=[ge.bedrock.id,ge.barrier.id,"minecraft:invisiblebedrock","minecraft:movingBlock","minecraft:movingblock","minecraft:moving_block"],Be=[ge.chest.id,ge.trappedChest.id],Ai=[f.chest.id,f.trappedChest.id,f.barrel.id,f.dispenser.id,f.dropper.id,f.furnace.id,"minecraft:lit_furnace",f.blastFurnace.id,"minecraft:lit_blast_furnace",f.smoker.id,"minecraft:lit_smoker",f.hopper.id,f.shulkerBox.id,f.undyedShulkerBox.id],Q={x:7,y:7,z:7};var Ne={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};var Jt="2.6.4-beta";var Me="https://discord.gg/dMa3A5UYKX";function z(t,e=[],n){if(ye(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.tell("You have been tried to kick, but you cant!"),n?.();try{t.runCommandAsync(`kick @s \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(o){if(t.triggerEvent("kick"),!/"statusCode":-2147352576/.test(o))return;n&&n()}}function m(t){return t instanceof mo?a.roles.get(t.name)??"member":a.roles.get(t)??"member"}function oe(t,e){if(typeof t=="string"){a.roles.set(t,e);let n=[...D.getPlayers()].find(o=>o.name==t);n?n.setDynamicProperty("role",e):new M(t,e)}else a.roles.set(t.name,e),t.setDynamicProperty("role",e)}function ye(t){return D.getDynamicProperty("worldsOwner")==t.id}function ot(){let t=D.getDynamicProperty("worldsOwner");return!t||t==""?null:t}function tn(){let t=ot();if(!t)return null;let e=a.ids.collection();return Object.keys(e).find(n=>e[n]===t)}function he(t){if(!t)return D.setDynamicProperty("worldsOwner","");D.setDynamicProperty("worldsOwner",t.id.toString())}function De(){return D.getDynamicProperty("isLockDown")??!1}function rt(t){D.setDynamicProperty("isLockDown",t)}function Re(){for(let t of y.getAllRegions()){let e=new Zt(t.from.x,t.dimensionId=="minecraft:overworld"?-64:0,t.from.z),n=new Zt(t.to.x,t.dimensionId=="minecraft:overworld"?-64:0,t.to.z);for(let o of e.blocksBetween(n))h[t.dimensionId].getBlock(o)?.setType(uo.deny)}}var it=[],en=0;function V(t,e=0){let n=en;return it[n]={callback:t,delay:e,lastCall:0},en=n+1,n}function nn(t){delete it[t]}I.subscribe(()=>{nt.runSchedule(()=>{let t=[...D.getPlayers()];for(let[e,n]of t.entries())if(m(n)!="admin")for(let o of Object.values(it))o.delay!=0&&nt.currentTick-o.lastCall<o.delay||(o.callback(n),e==t.length-1&&(o.lastCall=nt.currentTick))})});function C(t){switch(t){case"spam_config":return a.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1};case"cbe_config":return a.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1,canAddEnchantment:!1};case"gamemode_config":return a.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};case"nuker_data":return a.config.get("nuker_data")??{violationCount:0,banPlayer:!1};case"banned_items":return a.config.get("banned_items")??Wt;case"banned_blocks":return a.config.get("banned_blocks")??Xt;case"enchantments":return a.config.get("enchantments")??Ne;case"appealLink":return a.config.get("appealLink")??Me}}function X(t,e){a.config.set(t,e)}function on(t){return C("enchantments")[t.type.id]??t.type.maxLevel}function rn(t){return Object.values(fo).find(e=>[...D.getPlayers({name:t.name,gameMode:e})].length)}import{system as mn}from"@minecraft/server";import{system as po}from"@minecraft/server";var st={},sn={},j={};function go(t,e,n){if(e.length!=n.length)return[];let o=[];for(let r=0;r<n.length;r++){if(e[r]?.item?.amount<n[r]?.item?.amount||e[r]?.item?.amount>n[r]?.item?.amount&&e[r]?.item?.amount!=0){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"fluctuation"};o.push(i),j[t.id]=i;continue}if(n[r].uid!=e[r].uid)if(e[r]?.item&&n[r]?.item){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"swap"};o.push(i),j[t.id]=i}else if(n[r]?.item){if(n[r]?.item)if(j[t.id]?.changeType=="delete"&&j[t.id]?.uid==n[r].uid){let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"move"};o.push(i),j[t.id]=i;continue}else{let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"put"};o.push(i),j[t.id]=i}}else{let i={slot:r,uid:e[r].uid,item:e[r].item,changeType:"delete"};o.push(i),j[t.id]=i}}return o}function yo(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function ho(t){let e=[];for(let n=0;n<t.size;n++){let o=t.getItem(n);e[n]={uid:yo(o),item:o}}return e}po.runSchedule(()=>{for(let t of Object.values(st))for(let e of h.overworld.getEntities(t.entities)){let n=ho(e.getComponent("inventory").container),o=go(e,sn[e.id]??n,n);if(sn[e.id]=n,o.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete j[e.id];continue}for(let r of o)t.callback(e,r)}}},5);var be=class{static subscribe(e,n){let o=Date.now();return st[o]={callback:n,entities:e},o}static unsubscribe(e){delete st[e]}};import{Location as bo}from"@minecraft/server";var x={},re={};function an(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function cn(t,e){try{let n=t.getComponent("minecraft:inventory").container,o=[];for(let r=0;r<n.size;r++){let i=n.getItem(r);!i||i?.typeId==e?.typeId&&(o.push({slot:r,item:i}),n.setItem,r<9?t.runCommandAsync(`replaceitem entity @s slot.hotbar ${r} air`):t.runCommandAsync(`replaceitem entity @s slot.inventory ${r-9} air`))}await t.runCommandAsync(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let r of o)n.setItem(r.slot,r.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:new bo(t.location.x,t.location.y,t.location.z),maxDistance:2,closest:1})].forEach(o=>o.kill())}}function ln(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var Le=class{constructor(e,n,o){this.gui=e,this.slot=n,this.change=o}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await Bt(5),await e.show(this.gui.player)}};var ie=class{static spawnEntity(e){try{return e.dimension.spawnEntity(pe,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=ie.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.runScheduleId=mn.runSchedule(()=>{if(!this.entity)return this.despawn();if(this.player.getComponent("mark_variant").value==1)this.hasChestOpen||(this.slotChangeEvent=be.subscribe({type:pe},(n,o)=>{n.id==this.entity.id&&this.onSlotChange(o)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,this.player.rotation.x,this.player.rotation.y,!0)}catch{this.despawn()}},5)}setPage(e,n){let o=this.entity.getComponent("inventory").container;for(let i=0;i<o.size;i++)o.setItem(i,v);if(!Object.keys(re).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=re[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,v);else if(e.changeType=="delete"){if(n.item&&cn(this.player,e.item),!n.item&&!ln(this.entity,e.slot))return;n.action(new Le(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete x[this.player.name]}catch{}this.runScheduleId&&mn.clearRunSchedule(this.runScheduleId),this.slotChangeEvent&&be.unsubscribe(this.slotChangeEvent)}};import{ItemStack as ko}from"@minecraft/server";var w=class{constructor(e,n={},o){this.itemType=e,this.components=n,this.setItemStack=o}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new ko(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let o of this.components?.enchantments??[])n.addEnchantment(o);e.getComponent("enchantments").enchantments=n}return e}};function un(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,v);continue}o.setItem(r,i.item.itemStack)}}var Y=class{constructor(e,n=un){if(Object.keys(re).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],re[e]=this}setSlots(e,n,o){let r=n?{item:n,action:o}:null;for(let i of e)this.slots[i]=r;return this}};import{MinecraftItemTypes as dn}from"@minecraft/server";var Ps=new Y("home").setSlots([22],new w(dn.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new w(dn.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});I.subscribe(()=>{fn.runSchedule(()=>{for(let t of Io.getPlayers()){if(an(t)?.typeId!=Yt){x[t.name]&&x[t.name].despawn();continue}Object.keys(x).includes(t?.name)||m(t)=="admin"&&(x[t.name]=new ie(t))}},10)});fn.runSchedule(()=>{let t=Object.values(x).map(e=>e.entity.id);for(let e of h.overworld.getEntities({type:pe}))t.includes(e.id)||e.triggerEvent("despawn")},100);import{system as Co}from"@minecraft/server";var ke={};I.subscribe(()=>{Co.run(()=>{for(let t of Object.values(ke))!t.getConfig().enabled||t.enable()})});var P={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occurred.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invalidType":(t,e)=>`Type ${t} is not a valid type to add a ${e}`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"\xA7cYou've been temporarily muted in chat.","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry ${n}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry: ${n}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};var u=class{constructor(e,n,o=0,r){this.data=e;this.type=n;this.depth=o;this.parent=r;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new F(this.data.name),this.children=[],this.depth=o,this.parent=r,this.callback=null,q.push(this)}argument(e){let n=new u(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new me(e))}int(e){return this.argument(new ue(e))}array(e,n){return this.argument(new fe(e,n))}boolean(e){return this.argument(new de(e))}location(e){let n=this.argument(new U(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new u(e,new F(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};import{Player as gn}from"@minecraft/server";function pn(t,e,n,o="No Reason",r="Rubedo Auto Mod"){let i={key:e,playerName:t instanceof gn?t.name:t,date:Date.now(),duration:n?le(n):null,expire:n?le(n)+Date.now():null,reason:o,by:r};a.bans.set(e,i)}var A=class{constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){e instanceof gn?pn(e,e.id,n,o,r):pn(e,a.ids.get(e),n,o,r)}};function at(t,e,n,o,r){if(a.bans.get(a.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);t.reply("\xA7aClose chat to confirm"),K(t.sender,`Are you sure you want to ban ${e}, for ${n??"forever"}`,()=>{new A(e,n,o,t.sender.name),t.reply(P["modules.commands.ban.reply"](e,n,o))})}var ct=new u({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(m(t))});ct.literal({name:"add",description:"Bans a player"}).argument(new p.playerName).executes((t,e)=>{at(t,e,null,null,t.sender.name)}).argument(new p.duration("duration")).executes((t,e,n)=>{at(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,o)=>{at(t,e,n,o,t.sender.name)});ct.literal({name:"remove",description:"un-bans a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=a.bans.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not banned`);a.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to un-ban ${e}`)});ct.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=a.bans.values();if(e.length==0)return t.sender.tell("\xA7cNo one is banned!");t.sender.tell(`\xA72--- Showing Bans (${e.length}) ---`);for(let n of e)t.sender.tell(P["commands.ban.list.player"](n.playerName,n.reason,n.expire?ne(n.duration):"Forever"))});var Ie=new u({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>m(t)=="admin"});Ie.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let o=a[e].get(n);o?t.reply(JSON.stringify(o)):t.reply(`No data could be found for key ${n}`)}catch(o){t.reply(o+o.stack)}});Ie.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,o)=>{try{a[e].set(n,o),t.reply(`Set Key: "${n}", to value: "${o}" on table: "${e}"`)}catch(r){t.reply(r+r.stack)}});Ie.literal({name:"clear"}).string("table").executes((t,e)=>{try{a[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});Ie.literal({name:"keys",description:"Returns all keys on a database"}).string("table").executes((t,e)=>{try{let n=a[e].keys();t.reply(`Keys on database: ${e}: ${n}`)}catch(n){t.reply(n+n.stack)}});Ie.literal({name:"values",description:"Returns all values on a database"}).string("table").executes((t,e)=>{try{let n=a[e].values();t.reply(`Values on database: ${e}: ${JSON.stringify(n,null,2)}`)}catch(n){n instanceof TypeError?t.reply(`No values on database ${e}`):t.reply(n+n.stack)}});new u({name:"ecwipe",description:"Clears a players ender chest",requires:t=>m(t)=="admin"}).argument(new p.player("player")).executes((t,e)=>{for(let n=0;n<27;n++)e.runCommandAsync(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`\xA7aCleared "${e.name}"'s Ender chest!`)});var _e=class{constructor(e,n="No Reason"){let o={playerName:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};a.freezes.set(e.id,o)}};var lt=new u({name:"freeze",description:"Manage Freezes",requires:t=>["admin","moderator"].includes(m(t))});lt.literal({name:"add",description:"Freezes a player"}).argument(new p.player("player")).string("reason").executes((t,e,n)=>{new _e(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});lt.literal({name:"remove",description:"unfreezes a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=a.freezes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not frozen`);a.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});lt.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=a.freezes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is frozen!");t.sender.tell(`\xA72--- Showing Freezes (${e.length}) ---`);for(let n of e)t.sender.tell(P["commands.freeze.list.player"](n.playerName,n.reason))});var mt=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(q.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a valid command`}};function wo(t,e,n){n.tell(`${T}${t.data.name} ${e.map(o=>o.type.typeName=="literal"?o.data.name:`<${o.type.name}: ${o.type.typeName}>`).join(" ")}`)}function Oe(t,e,n,o){if(!!e.data?.requires(o)&&(e.callback&&wo(t,e.depth==0?n:n.concat(e),o),e.children.length>0))for(let r of e.children)Oe(t,r,e.depth==0?n:n.concat(e),o)}function yn(t,e,n){t.tell(`\xA72--- Showing help page ${e} of ${n} (${T}help <page: int>) ---`)}function ut(t){return q.filter(e=>e.depth==0&&e.data?.requires(t))}function hn(t){let e=ut(t);return e.length==0?0:Math.ceil(e.length/5)}var bn=new u({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=hn(t.sender),n=ut(t.sender).slice(1*5-5,1*5);yn(t.sender,1,e);for(let o of n)Oe(o,o,[],t.sender)});bn.int("page").executes((t,e)=>{let n=hn(t.sender);e>n&&(e=n);let o=ut(t.sender).slice(e*5-5,e*5);yn(t.sender,e,n);for(let r of o)Oe(r,r,[],t.sender)});bn.argument(new mt("command")).executes((t,e)=>{let n=q.filter(o=>o.depth==0&&o.data.name==e)[0];t.sender.tell(`\xA7e${n.data.name}: ${n.data.aliases?`aliases (${n.data.aliases.join(", ")})`:""}`),t.sender.tell(`\xA7e${n.data.description}`),t.sender.tell("Usage:"),Oe(n,n,[],t.sender)});import{world as kn}from"@minecraft/server";new u({name:"lockdown",description:"Toggles the servers lockdown, meaning no one can join",requires:t=>m(t)=="admin"}).executes(t=>{De()?(rt(!1),t.sender.tell("\xA7aUnlocked the server!")):(t.reply("\xA7aClose chat to confirm lockdown"),K(t.sender,P["commands.lockdown.confirm"],()=>{rt(!0);for(let e of kn.getPlayers())m(e)!="admin"&&z(e,P["lockdown.kick.message"]());kn.say("\xA7l\xA7cServer is now LOCKED!")}))});var N=class{static getMuteData(e){return a.mutes.get(e.name)}constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=n?le(n):null,s={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:o,by:r};a.mutes.set(e.name,s)}};var dt=new u({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(m(t))});dt.literal({name:"add",description:"Mutes a player"}).argument(new p.player("player")).argument(new p.duration("duration")).string("reason").executes((t,e,n,o)=>{new N(e,n,o,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${o}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${o}"`)});dt.literal({name:"remove",description:"un-mutes a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=a.mutes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not muted!`);a.mutes.delete(n.playerName);try{t.sender.runCommandAsync(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});dt.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=a.mutes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is muted!");t.sender.tell(`\xA72--- Showing Mutes (${e.length}) ---`);for(let n of e)t.sender.tell(P["commands.mutes.list.player"](n.playerName,n.reason,n.expire?ne(n.expire):"Forever"))});import{Location as Eo}from"@minecraft/server";var se=class{static isValid(e){return e.typeId!="minecraft:npc"?!1:$e.find(n=>Nt(n,e.location))?!0:!!a.npcs.keys().find(n=>e.id==n)}constructor(e,n){$e.push(e);let o=n.spawnEntity("minecraft:npc",e),r={dimension:o.dimension.id,x:o.location.x,y:o.location.y,z:o.location.z};a.npcs.set(o.id,r),In()}};new u({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>m(t)=="admin"}).executes(t=>{let{x:e,y:n,z:o}=t.sender.location;new se(new Eo(e,n,o),t.sender.dimension),t.reply("Spawned a verified npc at your current location")});import{system as Cn}from"@minecraft/server";async function vo(){let t=Date.now(),e=0;return new Promise(n=>{let o=Cn.runSchedule(()=>{Date.now()-t<1e3?e++:(Cn.clearRunSchedule(o),n(e))})})}new u({name:"ping",description:"Returns the current Ticks Per Second of the servers ping"}).executes(async t=>{let e=await vo();t.reply(`\xA7aCurrent Ticks Per Second: ${e>18?"\xA7f{ \xA7aGood":e>13?"\xA7f{ \xA7eOk":"\xA7f{ \xA7cSevere"} ${e} \xA7f}`)});import{BlockLocation as Ce}from"@minecraft/server";var we=new u({name:"region",description:"Create a Region",requires:t=>m(t)=="admin"});we.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,o,r)=>{new y({x:e,z:n},{x:o,z:r},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${o} 320 ${r}`)});we.literal({name:"remove",description:"Removes a region at the players current position"}).executes(t=>{let e=new Ce(t.sender.location.x,t.sender.location.y,t.sender.location.z);y.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});we.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{y.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});we.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=y.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var ft=we.literal({name:"permission",description:"Handles permissions for regions"});ft.literal({name:"set",description:"Sets a certain permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let o=y.blockLocationInRegion(new Ce(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!o)return t.reply("You are not in a region");o.changePermission(e,n),t.reply(`Changed permission ${e} to ${n}`)});ft.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=y.blockLocationInRegion(new Ce(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var wn=ft.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntities"});wn.literal({name:"add",description:"Adds a entity to the allowed entities list"}).string("entity").executes((t,e)=>{let n=y.blockLocationInRegion(new Ce(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;o.push(e),n.changePermission("allowedEntities",o),t.reply(`Added entity ${e} to the allowed entities of the region your currently standing in`)});wn.literal({name:"remove",description:"Removes a entity from the allowed entities in the region"}).string("entity").executes((t,e)=>{let n=y.blockLocationInRegion(new Ce(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;if(!o.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);o=o.filter(r=>r!=e),n.changePermission("allowedEntities",o),t.reply(`Removed entity ${e} to the allowed entities of the region your currently standing in`)});var pt=(r=>(r[r.member=0]="member",r[r.admin=1]="admin",r[r.moderator=2]="moderator",r[r.builder=3]="builder",r))(pt||{});var So=t=>isNaN(Number(t))===!1;function To(t){return Object.keys(t).filter(So).map(e=>t[e])}var gt=new u({name:"role",description:"Changes the role for a player",requires:t=>m(t)=="admin"||ye(t)});gt.literal({name:"set",description:"Sets the role for a player"}).argument(new p.playerName("playerName")).argument(new p.array("role",To(pt))).executes((t,e,n)=>{oe(e,n),t.reply(`Changed role of ${e} to ${n}`)});gt.literal({name:"get",description:"Gets the role of a player"}).argument(new p.playerName("playerName")).executes((t,e)=>{let n=m(e);t.reply(`${e} has role: ${n}`)});var yt=gt.literal({name:"owner",description:"Manages the owner"});yt.literal({name:"get",description:"Gets the owner of the world"}).executes(t=>{let e=ot(),n=a.ids.collection(),o=Object.keys(n).find(r=>n[r]===e);t.reply(`\xA7aServer Owner: ${o} (id: ${e})`)});yt.literal({name:"transfer",description:"Transfers the owner of the world",requires:t=>ye(t)}).argument(new p.player).executes((t,e)=>{K(t.sender,`Are you sure you want to transfer the server ownership to ${e.name}, this action is not reversible!`,()=>{he(e),t.reply(`\xA7aSet the server Owner to: ${e.name} (id: ${e.id})`)}),t.reply("\xA7aClose chat to confirm")});yt.literal({name:"clear",description:"clear's the owner of the world",requires:t=>ye(t)}).executes(t=>{K(t.sender,"Are you sure you want to clear the server owner, this action is not reversible!",()=>{he(null),t.reply('\xA7aCleared the server owner! run "/reload" or reload world to run "/function start" again!')}),t.reply("\xA7aClose chat to confirm")});import{ActionFormData as Po}from"@minecraft/server-ui";var L=class{constructor(e,n){this.title=e,this.body=n,this.form=new Po,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,o){return this.buttons.push({text:e,iconPath:n,callback:o}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{ModalFormData as Ao}from"@minecraft/server-ui";var Fe=class{constructor(e,n,o){this.form=e,this.player=n,this.callback=o}error(e){new Z("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var R=class{constructor(e){this.title=e,this.form=new Ao,e&&this.form.title(e),this.args=[]}addDropdown(e,n,o){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,o),this}addSlider(e,n,o,r,i){return this.args.push({type:"slider"}),this.form.slider(e,n,o,r,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,o){return this.args.push({type:"textField"}),this.form.textField(e,n,o),this}async show(e,n){for(let o=0;o<200;o++){let r=await this.form.show(e);if(r.cancelationReason!="userBusy"){n(new Fe(this,e,n),...r.formValues.map((i,s)=>this.args[s].type=="dropdown"?this.args[s].options[i]:i));return}}return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)")}};function En(t){new L("Manage Banned Items").addButton("Remove a Banned Item",null,()=>{xo(t)}).addButton("Ban an item",null,()=>{Ro(t)}).show(t)}function xo(t){new R("Remove Banned Items").addDropdown("Select item to remove",C("banned_items")).show(t,(e,n)=>{let o=C("banned_items");o=o.filter(r=>r!=n),X("banned_items",o),t.tell(`Removed Banned item "${n}"`)})}function Ro(t){new R("Add Banned Item").addTextField("Item Id","minecraft:string").show(t,(e,n)=>{let o=C("banned_items");if(o.includes(n))return e.error(`\xA7cItem "${n}" is already banned`);o.push(n),X("banned_items",o),t.tell(`Banned the item "${n}"`)})}function vn(t){new L("Manage Banned Blocks").addButton("Remove a Banned Block",null,()=>{Bo(t)}).addButton("Ban an block",null,()=>{No(t)}).show(t)}function Bo(t){new R("Remove Banned Block").addDropdown("Select block to remove",C("banned_blocks")).show(t,(e,n)=>{let o=C("banned_blocks");o=o.filter(r=>r!=n),X("banned_blocks",o),t.tell(`Removed Banned block "${n}"`)})}function No(t){new R("Add Banned Block").addTextField("Block Id","minecraft:barrier").show(t,(e,n)=>{let o=C("banned_blocks");if(o.includes(n))return e.error(`\xA7cBlock "${n}" is already banned`);o.push(n),X("banned_blocks",o),t.tell(`Banned the block "${n}"`)})}function Sn(t){new R("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(Ne),0).addTextField("Level (number)","5").show(t,(e,n,o)=>{if(isNaN(o))return e.error(`\xA7c"${o}" is not a number, please enter a value like, "3", "9", etc.`);let r=parseInt(o),i=C("enchantments");i[n]=r,X("enchantments",i),t.tell(`Set max level for ${n} to ${r}`)})}function Tn(t){new R("Manage Appeal Link").addTextField("Appeal Link",Me).show(t,(e,n)=>{X("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function Pn(t){let e=new L("Manage Protections");for(let n of Object.values(ke))e.addButton(n.name,n.iconPath,()=>{Do(n,t)});e.addButton("Back","textures/ui/arrow_dark_left_stretch.png",()=>{ze(t)}).show(t)}function Do(t,e){let n=t.getConfig(),o=new R(`Manage ${t.name} Protection Config`).addToggle("Enabled",n.enabled),r=[];for(let[i,s]of Object.entries(t.configDefault))r.push(i),typeof s.defaultValue=="boolean"?o.addToggle(s.description,n[i]):typeof s.defaultValue=="number"?o.addSlider(s.description,0,100,1,n[i]):o.addTextField(s.description,null,n[i]);o.show(e,(i,s,...c)=>{s!=n.enabled&&(s&&t.enable(),s||t.disable());let l={enabled:s};for(let[d,g]of Object.keys(t.configDefault).entries())l[g]=c[d];t.setConfig(l),e.tell(`Updated config for ${t.name}!`)})}function ze(t){new L("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{Pn(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{En(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{vn(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{Sn(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{Tn(t)}).show(t)}new u({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(m(t))}).executes(t=>{ze(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as An}from"@minecraft/server";function xn(t,e){if(t.hasTag("spectator")){if(t.runCommandAsync("gamemode c"),t.triggerEvent("removeSpectator"),t.removeTag("spectator"),!e)return;An.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommandAsync("gamemode spectator"),t.triggerEvent("addSpectator"),t.addTag("spectator"),!e)return;An.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new u({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>m(t)=="admin"}).executes(t=>{xn(t.sender,!1)}).boolean("say").executes((t,e)=>{xn(t.sender,e)});new u({name:"version",description:"Get Current Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${Jt}`)});new u({name:"kick",description:"Kicks a player from the game",requires:t=>m(t)=="admin"}).argument(new p.player).string("reason").executes((t,e,n)=>{z(e,[n]),t.reply(`\xA7aKicked ${e.name} from world`)});var _=class{constructor(e){this.data=e,console.warn(`[LOG]: ${e.message}`),a.logs.set(Date.now().toString(),e)}};function ht(t){var e=6e4,n=e*60,o=n*24,r=o*30,i=o*365,s=Date.now()-t;return s<e?Math.round(s/1e3)+" seconds ago":s<n?Math.round(s/e)+" minutes ago":s<o?Math.round(s/n)+" hours ago":s<r?"approximately "+Math.round(s/o)+" days ago":s<i?"approximately "+Math.round(s/r)+" months ago":"approximately "+Math.round(s/i)+" years ago"}var Ee=new u({name:"log",description:"Manages the log command",requires:t=>m(t)=="admin"});Ee.literal({name:"add",description:"Adds a new log"}).string("message").executes((t,e)=>{new _({message:e}),t.reply(`\xA7aAdded new log: ${e}`)});Ee.literal({name:"getAll",description:"Gets all logs sorted in descending"}).int("page").array("order",["ascending","descending"]).executes((t,e,n)=>{let o=Object.entries(a.logs.collection()).sort((i,s)=>n=="ascending"?parseInt(s[0])-parseInt(i[0]):parseInt(i[0])-parseInt(s[0]));if(o.length==0)return t.reply("\xA7cNo Logs have been made!");let r=Math.ceil(o.length/8);e>r&&(e=r),t.reply(`\xA72--- Showing logs page ${e} of ${r} (${T}log getAll <page: int>) ---`);for(let[i,s]of o.slice(e*8-8,e*8))t.reply(`${ht(parseInt(i))}: ${s.message}`)});Ee.literal({name:"getPlayersLogs",description:"Gets all logs associated with a player"}).argument(new p.playerName).int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(a.logs.collection()).filter(s=>s[1].playerName==e).sort((s,c)=>o=="ascending"?parseInt(c[0])-parseInt(s[0]):parseInt(s[0])-parseInt(c[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for "${e}" page ${n} of ${i} ---`);for(let[s,c]of r.slice(n*8-8,n*8))t.reply(`${ht(parseInt(s))}: ${c.message}`)});Ee.literal({name:"getProtectionLogs",description:"Gets all logs associated with a protection"}).string("protection").int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(a.logs.collection()).filter(s=>s[1].protection==e).sort((s,c)=>o=="ascending"?parseInt(c[0])-parseInt(s[0]):parseInt(s[0])-parseInt(c[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for protection: "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for Protection: "${e}" page ${n} of ${i} ---`);for(let[s,c]of r.slice(n*8-8,n*8))t.reply(`${ht(parseInt(s))}: ${c.message}`)});Ee.literal({name:"clearAll",description:"Clears all logs"}).executes(t=>{a.logs.clear(),t.reply("\xA7aCleared All logs!")});var _o=new u({name:"teleport",description:"Teleports entities (players, mobs, etc.).",aliases:["tp"],requires:t=>m(t)=="admin"});_o.argument(new p.player).location("destination").executes((t,e,n)=>{e.addTag("skip-movement-check"),e.teleport(n,e.dimension,0,0),t.reply(`Teleported ${e.name} to ${n.x} ${n.y} ${n.z}`)});V(t=>{try{let e=a.bans.get(t.id);if(!e)return;if(e.expire&&e.expire<Date.now())return a.bans.delete(t.id);z(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?ne(e.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${C("appealLink")}`],()=>{console.warn(new Error("Failed to kick player")),a.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as Oo}from"@minecraft/server";V(t=>{try{let e=a.freezes.get(t.id);if(!e)return t.getComponent("movement").resetToDefaultValue();t.getComponent("movement").setCurrent(0),t.teleport(new Oo(e.location.x,e.location.y,e.location.z),h[e.location.dimension],0,0)}catch{}},200);import{world as $o}from"@minecraft/server";var bt={};$o.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(T))for(let e of Object.values(bt))e.callback(t)});var Ve=class{static subscribe(e){let n=Date.now();return bt[n]={callback:e},n}static unsubscribe(e){delete bt[e]}};Ve.subscribe(t=>{let e=N.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return a.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(P["modules.managers.mute.isMuted"]())}});import{BlockLocation as Fo,system as Rn,world as kt}from"@minecraft/server";Rn.runSchedule(()=>{Re()},6e3);kt.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(m(t.source)))return;let e=y.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);Kt.includes(n.typeId)&&e.permissions.doorsAndSwitches||Ht.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});kt.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(y.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});kt.events.entityCreate.subscribe(async({entity:t})=>{let e=await y.blockLocationInRegionSync(new Fo(t.location.x,t.location.y,t.location.z),t.dimension.id);!e||e.permissions.allowedEntities.includes(t.typeId)||(t.teleport({x:0,y:-64,z:0},t.dimension,0,0),t.kill())});I.subscribe(()=>{Rn.runSchedule(async()=>{for(let t of await y.getAllRegionsSync())for(let e of h[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntities}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100)});V(t=>{for(let e of y.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as zo}from"@minecraft/server";zo.events.playerJoin.subscribe(async({player:t})=>{if(await I.awaitLoad(),De()&&m(t)!="admin")return z(t,P["lockdown.kick.message"]());N.getMuteData(t)&&t.runCommandAsync("ability @s mute true"),a.ids.has(t.name)?t.addTag("old"):a.ids.set(t.name,t.id);let e=M.getPlayersRoleToSet(t.name);e&&oe(t,e)});import{Items as Vo,MinecraftItemTypes as O,world as It}from"@minecraft/server";var Bn=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],jo=[10,11,12,13,14,15,16,19,20,21,22,23,24,25,28,29,30,31,32,33,34,37,38,39,40,41,42,43];function Yo(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,v);continue}o.setItem(r,i.item.itemStack)}for(let[r,i]of[...It.getPlayers()].entries()){let s=Bn[r],c=new w(O.skull,{nameTag:i.name,data:3});o.setItem(s,c.itemStack),e.slots[s]={item:c,action:l=>{l.PageAction("moderation:see_inventory",{name:i.name})}}}}function Go(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let l=0;l<o.size;l++){let d=e.slots[l];if(!d||!d.item){o.setItem(l,v);continue}o.setItem(l,d.item.itemStack)}let r=new w(O.enderChest,{nameTag:`\xA7eView \xA7f${n?.name}\xA7e Ender Chest
\xA7fNote: \xA7cThis will not grab \xA7lANY NBT!\xA7r`});o.setItem(49,r.itemStack),e.slots[49]={item:r,action:l=>{l.PageAction("moderation:see_ender_chest",{name:n.name})}};let i=[...It.getPlayers()].find(l=>l.name==n.name);i||(Object.values(x).find(d=>d.entity.id==t.id).despawn(),i.tell(`"${n.name}" Could not be found, Gui Crashed`));let s=i.getComponent("inventory").container,c=0;for(let l=0;l<s.size;l++){let d=s.getItem(l),g=Bn[c];if(c++,!d){o.setItem(g,v);continue}o.setItem(g,d),e.slots[g]={item:new w(Vo.get(d.typeId),{amount:d.amount,data:d.data},d),action:J=>{l<9?i.runCommandAsync(`replaceitem entity @s slot.hotbar ${l} air`):i.runCommandAsync(`replaceitem entity @s slot.inventory ${l-9} air`),J.GiveAction(),e.slots[g]={item:null,action:He=>{s.addItem(He.getItemAdded())}}}}}}async function Ko(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let c=0;c<o.size;c++){let l=e.slots[c];if(!l||!l.item){o.setItem(c,v);continue}o.setItem(c,l.item.itemStack)}let r=[...It.getPlayers()].find(c=>c.name==n?.name);r||(Object.values(x).find(l=>l.entity.id==t.id).despawn(),r.tell(`"${n.name}" Could not be found, Gui Crashed`));let i=0,s=Object.values(O);for(let c of s)try{await r.runCommandAsync(`testfor @s[hasitem={item=${c.id},location=slot.enderchest}]`);let l=new w(c,{nameTag:"Note: \xA7l\xA7cThis is not the exact item"}),d=jo[i];o.setItem(d,l.itemStack),e.slots[d]={item:l,action:g=>{g.GiveAction(),e.slots[d]=null}},i++}catch{}}new Y("moderation:see",Yo).setSlots([50],new w(O.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new w(O.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new Y("moderation:see_inventory",Go).setSlots([50],new w(O.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new w(O.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new Y("moderation:see_ender_chest",Ko).setSlots([50],new w(O.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new w(O.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{Player as Ho,MinecraftBlockTypes as Uo}from"@minecraft/server";import{system as Nn,world as Mn}from"@minecraft/server";var k=class{constructor(e,n,o,r){this.name=e;this.description=n;this.iconPath=o;this.isEnabledByDefault=r;this.name=e,this.description=n,this.iconPath=o,this.configDefault={},this.isEnabled=!1,this.isEnabledByDefault=r,this.events={},this.schedules=[],this.forEachValidPlayers=[],ke[this.name]=this}setConfigDefault(e){return this.configDefault=e,a.protections.hasSync(this.name).then(n=>{if(n)return;let o={enabled:!0};for(let r of Object.keys(e))o[r]=e[r].defaultValue;a.protections.set(this.name,o)}),this}getConfig(){let e=a.protections.get(this.name);return e||(e={enabled:this.isEnabled}),e}async setConfig(e){return a.protections.set(this.name,e)}triggerChange(e){if(e){this.isEnabled=!0,this.onEnableCallback?.();for(let[n,o]of Object.entries(this.events)){if(o.triggered)continue;let r=Mn.events[n].subscribe(o.callback);o.triggered=!0,o.callback=r}for(let n of this.forEachValidPlayers){if(n.key)continue;let o=V(n.callback,n.delay);n.key=o}for(let n of this.schedules){if(n.runScheduleId)continue;let o=Nn.runSchedule(n.callback);n.runScheduleId=o}}else{this.isEnabled=!1,this.onDisableCallback?.();for(let[n,o]of Object.entries(this.events))!o.triggered||(Mn.events[n].unsubscribe(o.callback),o.triggered=!1);for(let n of this.forEachValidPlayers)!n.key||(nn(n.key),n.key=null);for(let n of this.schedules)!n.runScheduleId||(Nn.clearRunSchedule(n.runScheduleId),n.runScheduleId=null)}}onEnable(e){return this.onEnableCallback=e,this}onDisable(e){return this.onDisableCallback=e,this}subscribe(e,n){return this.events[e]={callback:n,triggered:!1},this}runSchedule(e,n){return this.schedules.push({callback:e,tickInterval:n,runScheduleId:null}),this}forEachValidPlayer(e,n=0){return this.forEachValidPlayers.push({callback:e,delay:n,key:null}),this}enable(){this.triggerChange(!0)}disable(){this.triggerChange(!1)}};var qo=["minecraft:command_block_minecart"],je=new k("cbe","Stops CBE","textures/blocks/command_block.png",!0).setConfigDefault({entityCreate:{description:"Adds NPC protection",defaultValue:!0},banSpawnEggs:{description:"If spawn eggs should be banned",defaultValue:!0}});je.subscribe("entityCreate",({entity:t})=>{if(!je.getConfig().entityCreate)return;let n=()=>{try{t.triggerEvent("despawn"),t.kill()}catch{t.kill()}};if(qo.includes(t.typeId)||t.typeId=="minecraft:npc"&&!se.isValid(t))return n()});je.subscribe("beforeItemUseOn",t=>{if(!(t.source instanceof Ho)||["admin","moderator"].includes(m(t.source)))return;let e=je.getConfig();if(t.item.typeId.endsWith("spawn_egg")){if(!e.banSpawnEggs||t.source.dimension.getBlock(t.blockLocation).typeId==Uo.mobSpawner.id)return;t.cancel=!0,t.source.tell("\xA7c[Rubedo]: You cannot place spawnEggs on the floor!"),t.source.playSound("note.bass")}else{if(Qt.includes(t.item.typeId)){t.cancel=!0;return}if(!C("banned_blocks").includes(t.item.typeId))return;t.cancel=!0,new A(t.source,null,"Placing Banned Blocks")}});var Ct=32e4;new k("crasher","Protection against type 1 crasher","textures/ui/servers.png",!0).forEachValidPlayer(t=>{(Math.abs(t.location.x)>Ct||Math.abs(t.location.y)>Ct||Math.abs(t.location.z)>Ct)&&new A(t,null,"Crasher detected")});import{GameMode as Qo,world as Xo}from"@minecraft/server";import{world as Wo}from"@minecraft/server";var E=class{constructor(){this.data=new Map,this.events={playerLeave:Wo.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}includes(e){return this.playerNames().includes(e.name)}};var Jo=Qo.creative,Dn=new E,Ln=new k("gamemode","Blocks illegal gamemode","textures/ui/creative_icon.png",!0).setConfigDefault({clearPlayer:{description:"Whether to clear players inventory.",defaultValue:!0},setToSurvival:{description:"If player should be set to survival after being flagged.",defaultValue:!0},banPlayer:{description:"If player should be banned after violation count is met.",defaultValue:!1},violationCount:{description:"The amount of violations before ban.",defaultValue:0}});Ln.runSchedule(()=>{let t=Ln.getConfig();for(let e of Xo.getPlayers({gameMode:Jo})){if(["moderator","admin","builder"].includes(m(e)))continue;try{t.setToSurvival&&e.runCommandAsync("gamemode s"),t.clearPlayer&&e.runCommandAsync("clear @s")}catch{}new _({playerName:e.name,protection:"Gamemode",message:`${e.name} has entered into a illegal gamemode!`});let n=(Dn.get(e)??0)+1;Dn.set(e,n),t.banPlayer&&n>=t.violationCount&&new A(e,null,"Illegal Gamemode")}},20);import{world as tr,Location as nr,system as or}from"@minecraft/server";import{system as Zo,world as er}from"@minecraft/server";var Ye=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var Ge={};Zo.runSchedule(()=>{Ge={};for(let t of er.getPlayers()){if(t.dimension.id!="minecraft:overworld")continue;let e=Rt(t.location),n=e.offset(Q.x,Q.y,Q.z),o=e.offset(-Q.x,-Q.y,-Q.z);for(let r of n.blocksBetween(o)){if(r.y<-64)continue;let i=t.dimension.getBlock(r);!i||!Be.includes(i.typeId)||(Ge[JSON.stringify(r)]=new Ye(i.getComponent("inventory").container))}}},100);var wt={};tr.events.blockBreak.subscribe(t=>{for(let e of Object.values(wt))e.callback(new Et(t.block,t.brokenBlockPermutation,t.dimension,t.player))});var ve=class{static subscribe(e){let n=Date.now();return wt[n]={callback:e},n}static unsubscribe(e){delete wt[e]}},Et=class{constructor(e,n,o,r){this.block=e;this.brokenBlockPermutation=n;this.dimension=o;this.player=r;this.block=e,this.brokenBlockPermutation=n,this.dimension=o,this.player=r}set cancel(e){if(this.dimension.getBlock(this.block.location).setPermutation(this.brokenBlockPermutation.clone()),Be.includes(this.brokenBlockPermutation.type.id)){let n=Ge[JSON.stringify(this.block.location)];n&&n.load(this.block.getComponent("inventory").container)}or.run(()=>{[...this.dimension.getEntities({maxDistance:2,type:"minecraft:item",location:new nr(this.block.location.x,this.block.location.y,this.block.location.z)})].forEach(n=>n.kill())})}};var _n=new E,rr=15,ir=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area"],sr=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],On=new E,$n=null,Fn=new k("nuker","Blocks block breaking too fast","textures/blocks/dirt.png",!0).setConfigDefault({banPlayer:{description:"If the player should be banned once violation count is met",defaultValue:!1},violationCount:{description:"Violations before ban",defaultValue:0}});Fn.onEnable(()=>{let t=Fn.getConfig();$n=ve.subscribe(e=>{if(["moderator","admin"].includes(m(e.player))||e.block.getTags().some(o=>ir.includes(o)))return;let n=_n.get(e.player);if(_n.set(e.player,Date.now()),!!n){if(!sr.includes(e.block.typeId)){if(n<Date.now()-rr)return;let o=(On.get(e.player)??0)+1;On.set(e.player,o),t.banPlayer&&o>=t.violationCount&&new A(e.player,null,"Using Nuker")}e.cancel=!0}})}).onDisable(()=>{ve.unsubscribe($n)});var zn=new E,Vn=new E,jn=new k("spam","Blocks spam in chat","textures/ui/mute_on.png",!0).setConfigDefault({permMutePlayer:{description:"If player should be permanently muted once violation count is met.",defaultValue:!1},violationCount:{description:"Violation count before permanent mute",defaultValue:0},repeatedMessages:{description:"Blocks repeated messages",defaultValue:!0},zalgo:{description:"Blocks zalgo",defaultValue:!0}});jn.subscribe("beforeChat",t=>{try{if(t.message.startsWith(T)||["admin","moderator"].includes(m(t.sender)))return;let e=jn.getConfig(),n=()=>{let o=(Vn.get(t.sender)??0)+1;Vn.set(t.sender,o),e.permMutePlayer&&o>=e.violationCount&&new N(t.sender,null,"Spamming")};if(e.repeatedMessages&&zn.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");zn.set(t.sender,t.message)}catch(e){console.warn(e+e.stack)}});var Yn=new E;function Ke(t,e){let n=t.getComponent("inventory").container,o=n.getItem(e),r=C("cbe_config");if(r.clearItem&&n.setItem(e,v),new _({playerName:t.name,message:`${t.name} Has obtained a unobtainable item: ${o.typeId}`,protection:"unobtainable"}),!r.banPlayer)return;let i=(Yn.get(t)??0)+1;Yn.set(t,i),!(i<r.violationCount)&&new A(t,null,"Possession of Unobtainable item")}new k("unobtainable","Blocks unobtainable items","textures/blocks/end_portal.png",!0).forEachValidPlayer(t=>{console.warn("unobtainable");let e=C("banned_items"),n=t.getComponent("inventory").container;for(let o=0;o<n.size;o++){let r=n.getItem(o);if(!r)continue;if(e.includes(r.typeId))return Ke(t,o);if(qt.includes(r.typeId))return new _({playerName:t.name,message:`${t.name} Has obtained a Forbidden item: ${r.typeId}`,protection:"unobtainable"}),n.setItem(o,v);let i=[];for(let s of r.getComponent("enchantments").enchantments){let c=on(s);if(s.level>c||s.level<1||i.includes(s.type.id))return Ke(t,o);i.push(s.type.id)}}});import{MinecraftBlockTypes as S,MinecraftEntityTypes as ar,MinecraftItemTypes as G,Player as cr}from"@minecraft/server";var lr=[S.chest.id,S.trappedChest.id,S.barrel.id,S.dispenser.id,S.dropper.id,S.furnace.id,S.litFurnace.id,S.blastFurnace.id,S.litBlastFurnace.id,S.smoker.id,S.litSmoker.id,S.hopper.id,S.beehive.id,S.beeNest.id,S.mobSpawner.id],mr=[G.chestBoat.id,G.oakChestBoat.id,G.birchChestBoat.id,G.acaciaChestBoat.id,G.jungleChestBoat.id,G.spruceChestBoat.id,G.darkOakChestBoat.id,G.mangroveChestBoat.id];new k("nbt","Blocks illegal nbt on items","textures/ui/icon_random.png",!0).subscribe("blockPlace",async({block:t})=>{if(!lr.includes(t.typeId))return;let e=t.permutation;await t.dimension.runCommandAsync(`setblock ${t.x} ${t.y} ${t.z} ${t.typeId}`),t.setPermutation(e)}).subscribe("beforeItemUseOn",t=>{t.source instanceof cr&&(!mr.includes(t.item.typeId)||(t.cancel=!0,t.source.dimension.spawnEntity(ar.chestBoat.id,t.blockLocation.above()),rn(t.source)!="creative"&&t.source.getComponent("inventory").container.setItem(t.source.selectedSlot,v)))});import{MinecraftEffectTypes as gr,MinecraftItemTypes as Xn,Player as Tt}from"@minecraft/server";import{system as ur,world as dr}from"@minecraft/server";var vt={};function fr(t,e){return!(t.x!=e.x||t.y!=e.y||t.z!=e.z)}var St=new E;ur.runSchedule(()=>{let t=(e,n)=>{for(let o of Object.values(vt))o.callback(e,n)};for(let e of dr.getPlayers()){let n=St.get(e);n&&fr(e.location,n.location)||(St.set(e,{location:e.location,dimension:e.dimension}),n&&t(e,n))}});var $=class{static subscribe(e){let n=Date.now();return vt[n]={callback:e},n}static unsubscribe(e){delete vt[e]}static delete(e){St.delete(e)}};var Gn={walk:{velocity:.17,distance:.23},run:{velocity:.19,distance:.35}},Kn=.056,Hn=10,Un=["gliding","riding"];var qn=new E;function yr(t,e){return Math.hypot(e.x-t.x,e.z-t.z)}function hr(t){return(t.getEffect(gr.speed)?.amplifier??0)*Kn}function br(t,e){let n=hr(e),o=Gn.run.distance+.8;return t>n+o}function Wn(t,e){let n=(qn.get(t)??0)+1;qn.set(t,n),$.delete(t),!(n<3)&&t.teleport(e.location,e.dimension,t.rotation.x,t.rotation.y)}var Qn=null,Se=new k("movement","Blocks illegal movements on players","textures/ui/move.png",!0).setConfigDefault({tpCheck:{description:"If teleports should be flagged",defaultValue:!0}});Se.onEnable(()=>{let t=Se.getConfig();Qn=$.subscribe((e,n)=>{if(m(e)=="admin"||e.dimension.id!=n.dimension.id||e.getTags().some(r=>Un.includes(r)))return;let o=yr(e.location,n.location);if(e.hasTag("skip-movement-check"))return e.removeTag("skip-movement-check");if(o>Hn){if(!t.tpCheck)return;Wn(e,n)}else{if(!br(o,e))return;Wn(e,n)}})}).onDisable(()=>{$.unsubscribe(Qn)});Se.subscribe("dataDrivenEntityTriggerEvent",t=>{t.entity instanceof Tt&&t.id=="on_death"&&$.delete(t.entity)});Se.subscribe("projectileHit",({projectile:t,source:e})=>{t.typeId==Xn.enderPearl.id&&e instanceof Tt&&$.delete(e)});Se.subscribe("itemCompleteCharge",({itemStack:t,source:e})=>{t.typeId==Xn.chorusFruit.id&&e instanceof Tt&&$.delete(e)});import{MinecraftEffectTypes as kr,Player as Ir,world as Jn}from"@minecraft/server";var Cr=Jn.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(!(t.entity instanceof Ir)||t.id!="rubedo:becomeAdmin")return;t.entity.removeTag("CHECK_PACK");let e=tn();if(e)return t.entity.playSound("note.bass"),t.entity.tell(`\xA7cFailed to give server owner: "${e}" is already owner!`),Jn.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(Cr);oe(t.entity,"admin"),he(t.entity),t.entity.addEffect(kr.blindness,3,255,!0),t.entity.tell('\xA7aYou have now been set as the "owner" of this server. The command "/function start" will not do anything anymore, type "-help" for more information!')});import{DynamicPropertiesDefinition as eo,MinecraftEntityTypes as wr,world as to}from"@minecraft/server";var Zn=[];to.events.worldInitialize.subscribe(({propertyRegistry:t})=>{let e=new eo;e.defineString("role",30),t.registerEntityTypeDynamicProperties(e,wr.player);let n=new eo;n.defineString("worldsOwner",100),n.defineBoolean("isLockDown"),t.registerWorldDynamicProperties(n);for(let o of Zn)to.scoreboard.addObjective(o.objective,o.displayName??"")});var $e=[];function In(){$e=[]}console.warn("----- Importing Plugins -----");import{DynamicPropertiesDefinition as Er,EntityTypes as vr,world as Sr}from"@minecraft/server";Sr.events.worldInitialize.subscribe(({propertyRegistry:t})=>{h.overworld.runCommandAsync(`tickingarea add ${B.x} ${B.y} ${B.z} ${B.x} ${B.y} ${B.z} db true`);let e=new Er;e.defineString("tableName",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,vr.get(ae))});console.warn("---- STARTING RUBEDO ----");Ar.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});var v=new Tr(Pr.stick,0);export{v as AIR};
//# sourceMappingURL=index.js.map
